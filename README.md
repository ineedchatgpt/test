var _gaq=[],fbdExtensionApp=(!function(){var t,e,o,n;t=window,n=document,e="script",o="ga",t.GoogleAnalyticsObject=o,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=+new Date,o=n.createElement(e),n=n.getElementsByTagName(e)[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",n.parentNode.insertBefore(o,n),ga("create","UA-64751394-1","auto"),ga("set","checkProtocolTask",null),setInterval(function(){t=localStorage._analytics_last_time,t=parseInt(t);var t=t=isNaN(t)?0:t;864e5<(new Date).getTime()-t&&(console.log("SEND"),ga("send","pageview"),localStorage._analytics_last_time=(new Date).getTime())},6e4)}(),{noYoutube:!0,noLink:!0,noImage:!0,noFile:!0,noGame:!1,noWelcome:!1});class ValidateUri{constructor(){this._blacklist=[],this._whitelist=[],this._queue={},this._addListener()}_addListener(){document.addEventListener("isAdultWebsite",t=>{var e;t&&t.detail&&t.detail.dcurr&&t.detail.rsp&&(e="ADULT"===t.detail.rsp,this._updateList(e?this._blacklist:this._whitelist,t.detail.dcurr))}),chrome.runtime.onMessage.addListener((e,t,o)=>{if(e.websiteToValidate)return this.isAdult(e.websiteToValidate).then(t=>{o({is_adult:t,websiteToValidate:e.websiteToValidate})}),!0})}_updateList(t,e){e=this._getDomainName(e);return!t.includes(e)&&t.push(e)}_basicValidation(t){return!!t&&t.startsWith("http")}_getDomainName(t){var e=document.createElement("a");return e.href=t,e.origin}isAdult(n){return new Promise((t,e)=>{var o;this._basicValidation(n)?(o=this._getDomainName(n),this.setQueue(o,t)):t(!1)})}_checkUri(t){return!!this._blacklist.includes(t)||!this._whitelist.includes(t)&&null}_checkInManualBlacklist(t){this._manual_blacklist=["http://pornotube.com/","http://dachix.com/","http://badjojo.com/","http://pornhub.com/","http://redtube.com/","http://xtube.com/","http://empflix.com/","http://xhamster.com/","http://adultlibrary.com/","http://youjizz.com/","http://www.hentaitube.tv/","http://video.xnxx.com/","http://wankerhut.com/","http://shufuni.com/","http://nefesnefese.net/","http://spankwire.com/","http://moviefap.com/","http://xvideos.com/","http://extremetube.com/","http://submityourflicks.com/","http://hardsextube.com/","http://www.pornrabbit.com/","http://bravomamas.com/","http://youngleafs.com/","http://bravoteens.com/","http://deviantclip.com/","http://flytube.com/","http://tube8.com/","http://teenist.com/","http://www.pornotube.com/","http://www.dachix.com/","http://www.badjojo.com/","http://www.pornhub.com/","http://www.redtube.com/","http://www.xtube.com/","http://www.empflix.com/","http://www.xhamster.com/","http://www.adultlibrary.com/","http://www.youjizz.com/","http://www.www.hentaitube.tv/","http://www.video.xnxx.com/","http://www.wankerhut.com/","http://www.shufuni.com/","http://www.nefesnefese.net/","http://www.spankwire.com/","http://www.moviefap.com/","http://www.xvideos.com/","http://www.extremetube.com/","http://www.submityourflicks.com/","http://www.hardsextube.com/","http://www.www.pornrabbit.com/","http://www.bravomamas.com/","http://www.youngleafs.com/","http://www.bravoteens.com/","http://www.deviantclip.com/","http://www.flytube.com/","http://www.tube8.com/","http://www.teenist.com/","https://pornotube.com/","https://dachix.com/","https://badjojo.com/","https://pornhub.com/","https://redtube.com/","https://xtube.com/","https://empflix.com/","https://xhamster.com/","https://adultlibrary.com/","https://youjizz.com/","https://www.hentaitube.tv/","https://video.xnxx.com/","https://wankerhut.com/","https://shufuni.com/","https://nefesnefese.net/","https://spankwire.com/","https://moviefap.com/","https://xvideos.com/","https://extremetube.com/","https://submityourflicks.com/","https://hardsextube.com/","https://www.pornrabbit.com/","https://bravomamas.com/","https://youngleafs.com/","https://bravoteens.com/","https://deviantclip.com/","https://flytube.com/","https://tube8.com/","https://teenist.com/","https://www.pornotube.com/","https://www.dachix.com/","https://www.badjojo.com/","https://www.pornhub.com/","https://www.redtube.com/","https://www.xtube.com/","https://www.empflix.com/","https://www.xhamster.com/","https://www.adultlibrary.com/","https://www.youjizz.com/","https://www.www.hentaitube.tv/","https://www.video.xnxx.com/","https://www.wankerhut.com/","https://www.shufuni.com/","https://www.nefesnefese.net/","https://www.spankwire.com/","https://www.moviefap.com/","https://www.xvideos.com/","https://www.extremetube.com/","https://www.submityourflicks.com/","https://www.hardsextube.com/","https://www.www.pornrabbit.com/","https://www.bravomamas.com/","https://www.youngleafs.com/","https://www.bravoteens.com/","https://www.deviantclip.com/","https://www.flytube.com/","https://www.tube8.com/","https://www.teenist.com/","http://myhomeclip.com/","http://rude.com/","http://beeg.com/","http://lubetube.com/","http://indianpornvideos.com/","http://h2porn.com/","http://celebrityfakevideo.com/","http://motherless.com/","http://topamateurporn.com/","http://youfreeporn.us","http://asianpornmovies.com/","http://www.indianxtube.com/","http://xxxbunker.com/","http://gaywatch.com/","http://tube.abigtits.com/","http://www.myhomeclip.com/","http://www.rude.com/","http://www.beeg.com/","http://www.lubetube.com/","http://www.indianpornvideos.com/","http://www.h2porn.com/","http://www.celebrityfakevideo.com/","http://www.motherless.com/","http://www.topamateurporn.com/","http://www.youfreeporn.us","http://www.asianpornmovies.com/","http://www.www.indianxtube.com/","http://www.xxxbunker.com/","http://www.gaywatch.com/","http://www.tube.abigtits.com/","https://myhomeclip.com/","https://rude.com/","https://beeg.com/","https://lubetube.com/","https://indianpornvideos.com/","https://h2porn.com/","https://celebrityfakevideo.com/","https://motherless.com/","https://topamateurporn.com/","https://youfreeporn.us","https://asianpornmovies.com/","https://www.indianxtube.com/","https://xxxbunker.com/","https://gaywatch.com/","https://tube.abigtits.com/","https://www.rude.com/","https://www.beeg.com/","https://www.lubetube.com/","https://www.indianpornvideos.com/","https://www.h2porn.com/","https://www.celebrityfakevideo.com/","https://www.motherless.com/","https://www.topamateurporn.com/","https://www.youfreeporn.us","https://www.asianpornmovies.com/","https://www.www.indianxtube.com/","https://www.xxxbunker.com/","https://www.gaywatch.com/","https://www.tube.abigtits.com/","http://tubethumbs.com/","http://tjoob.com/","http://moviesand.com/","http://home-video-tube.com/","http://iyottube.com/","http://eporner.com/","http://moviesguy.com/","http://cliphunter.com/","http://homemoviestube.com/","http://mofosex.com/","http://porntube.com/","http://sextube.com/","http://tubety.com","http://submityourtapes.com/","http://amateurboobtube.com/","http://bravotube.com/","http://eroprofile.com/","http://freefuckvidz.com/","http://ashemaletube.com/","http://xxxkinky.com/","http://vidsvidsvids.com/","http://boyfriendtv.com/","http://keezmovies.com/","http://yuvutu.com/","http://gayforit.com/","http://5ilthy.com/","http://alotporn.com/","http://pridetube.com/","http://tnaflix.com/","http://lesbianpornvideos.com/","http://pornoxo.com/","http://porn.com/","http://tokyoporn.com/","http://liseli-porn.com/","http://gotgayporn.com/","http://realgfporn.com/","http://www.tubethumbs.com/","http://www.tjoob.com/","http://www.moviesand.com/","http://www.home-video-tube.com/","http://www.iyottube.com/","http://www.eporner.com/","http://www.moviesguy.com/","http://www.cliphunter.com/","http://www.homemoviestube.com/","http://www.mofosex.com/","http://www.porntube.com/","http://www.sextube.com/","http://www.tubety.com","http://www.submityourtapes.com/","http://www.amateurboobtube.com/","http://www.bravotube.com/","http://www.eroprofile.com/","http://www.freefuckvidz.com/","http://www.ashemaletube.com/","http://www.xxxkinky.com/","http://www.vidsvidsvids.com/","http://www.boyfriendtv.com/","http://www.keezmovies.com/","http://www.yuvutu.com/","http://www.gayforit.com/","http://www.5ilthy.com/","http://www.alotporn.com/","http://www.pridetube.com/","http://www.tnaflix.com/","http://www.lesbianpornvideos.com/","http://www.pornoxo.com/","http://www.porn.com/","http://www.tokyoporn.com/","http://www.liseli-porn.com/","http://www.gotgayporn.com/","http://www.realgfporn.com/","https://tubethumbs.com/","https://tjoob.com/","https://moviesand.com/","https://home-video-tube.com/","https://iyottube.com/","https://eporner.com/","https://moviesguy.com/","https://cliphunter.com/","https://homemoviestube.com/","https://mofosex.com/","https://porntube.com/","https://sextube.com/","https://tubety.com","https://submityourtapes.com/","https://amateurboobtube.com/","https://bravotube.com/","https://eroprofile.com/","https://freefuckvidz.com/","https://ashemaletube.com/","https://xxxkinky.com/","https://vidsvidsvids.com/","https://boyfriendtv.com/","https://keezmovies.com/","https://yuvutu.com/","https://gayforit.com/","https://5ilthy.com/","https://alotporn.com/","https://pridetube.com/","https://tnaflix.com/","https://lesbianpornvideos.com/","https://pornoxo.com/","https://porn.com/","https://tokyoporn.com/","https://liseli-porn.com/","https://gotgayporn.com/","https://realgfporn.com/","https://www.tubethumbs.com/","https://www.tjoob.com/","https://www.moviesand.com/","https://www.home-video-tube.com/","https://www.iyottube.com/","https://www.eporner.com/","https://www.moviesguy.com/","https://www.cliphunter.com/","https://www.homemoviestube.com/","https://www.mofosex.com/","https://www.porntube.com/","https://www.sextube.com/","https://www.tubety.com","https://www.submityourtapes.com/","https://www.amateurboobtube.com/","https://www.bravotube.com/","https://www.eroprofile.com/","https://www.freefuckvidz.com/","https://www.ashemaletube.com/","https://www.xxxkinky.com/","https://www.vidsvidsvids.com/","https://www.boyfriendtv.com/","https://www.keezmovies.com/","https://www.yuvutu.com/","https://www.gayforit.com/","https://www.5ilthy.com/","https://www.alotporn.com/","https://www.pridetube.com/","https://www.tnaflix.com/","https://www.lesbianpornvideos.com/","https://www.pornoxo.com/","https://www.porn.com/","https://www.tokyoporn.com/","https://www.liseli-porn.com/","https://www.gotgayporn.com/","https://www.realgfporn.com/"];t=t.match(/^((https?:\/\/)(www\.)?([0-9a-z-\.]+))/);if(null==t)return!1;{const e=t[1]+"/",o=(""===t[3]?t[2]+"www."+t[4]:t[2]+t[4])+"/",n=this._manual_blacklist.find(t=>t.includes(e)||t.includes(o));return!!n}}async setQueue(t,e,o=0){o++;let n=this._checkUri(t);if(null===n){if(5!==o)return setTimeout(()=>{this.setQueue(t,e,o)},100*o);n=this._checkInManualBlacklist(t)}e(n)}}function SimplyCache(t){this.ttl=t,this.purge=0,this.cache={},this.check_info=function(t){if(t in this.cache){if(this.cache[t].ttl>(new Date).getTime()-this.ttl)return!0;delete this.cache[t]}return!1},this.put_info=function(t,e){e={value:e,ttl:(new Date).getTime()};this.cache[t]=e,this.cache_purge()},this.get_info=function(t){return this.check_info(t)?this.cache[t].value:null},this.clear_info=function(t){t in this.cache&&delete this.cache[t]},this.cache_purge=function(){if(this.purge++,20<this.purge){var t,e=(new Date).getTime()-this.ttl;for(t in this.cache)this.cache[t].ttl<e&&delete this.cache[t];this.purge=0}}}function FBD_site_detector(){this.sites={VIDEO:["http://www.metacafe.com/","http://www.dailymotion.com/","http://www.break.com/","http://blip.tv/","http://pornotube.com/","http://www.myvideo.de/","http://www.yikers.com/","http://vimeo.com/","http://revver.com/","http://www.kontraband.com/","http://dachix.com/","http://www.collegehumor.com/","http://www.badjojo.com/","http://www.vkontakte.ru/","http://www.blastro.com/","http://flashgames247.com/","http://www.mysexgames.com/","http://videoalbumy.azet.sk/","http://www.pornhub.com/","http://www.zoopgames.com/","http://gamesvine.com/","http://www.addictinggames.com/","http://www.gamespot.com/","http://www.net-games.biz/","http://redtube.com/","http://armorgames.com/","http://funnyjunk.com/","http://www.flurl.com/","http://xtube.com/","http://www.storm-games.com/","http://www.santabanta.com/","http://www.empflix.com/","http://www.liveleak.com/","http://movie-list.com/","http://www.adultswim.com/","http://www.veoh.com/","http://xhamster.com/","http://www.vureel.com/","http://theync.com/","http://www.adultlibrary.com/","http://www.gametrailers.com/","http://www.stickpage.com/","http://www.musictend.com/","http://apnatube.com/","http://video.azbuz.com/","http://www.youjizz.com/","http://hell-cat.com/","http://rian.ru/","http://www.cbs.com/","http://www.tvigle.ru/","http://life.ru/","http://www.tvazteca.com/","http://edition.cnn.com/","http://www.hornygamer.com/","http://www.nba.com/","http://moviegator.com/","http://tv-video.net/","http://www.videodust.com/","http://www.greektube.org/","http://www.humour.com/","http://hi5.com/","http://www.guba.com/","http://www.1tv.ru/","http://www.tac.tv/","http://eska.pl/","http://winxland.ru/","http://vbox7.com/","http://kefche.com/","http://www.liveinternet.ru/","http://www.ysmile.com/","http://flash.playcomet.com/","http://www.reuters.com/","http://www.wcco.com/","http://cbs5.com/","http://www.latimes.com/","http://www.cbsnews.com/","http://oddych.sk/","http://www.dalealplay.com/","http://www.lastfm.ru/","http://itv.by/","http://wbztv.com/","http://www.stupidvideos.com/","http://www.bofunk.com/","http://www.blinkx.com/","http://inkafilm.ru/","http://video.privet.ru/","http://play.ukr.net/","http://video.ru/","http://yashik.tv/","http://video.bigmir.net/","http://movielab.tv/","http://www.5min.com/","http://www.youtube.com/","http://www.boreme.com/","http://www.56.com/","http://www.clipsyndicate.com/","http://www.dingtv.com/","http://www.esnips.com/","http://www.flix.co.il/","http://www.hungryflix.com/","http://vision.ameba.jp/","http://www.dag.nl/","http://www.komikler.com/","http://vtc.com.vn/","http://www.firstshowing.net/","http://tesla.liketelevision.com/","http://www.sidereel.com/","http://www.thepiratecity.org/","http://www.vedomosti.ru/","http://video.rosbalt.ru/","http://vision.rambler.ru/","http://phoanime.com/","http://www.ozini.com/","http://www.oyunlar1.com/","http://www.123video.nl/","http://www.adn.es/","http://allhiphop.com/","http://gprime.net/","http://video.qip.ru/","http://www.tmz.com/","http://badoo.com/","http://tangle.com/","http://bashtube.ru/","http://video.fr/","http://sapo.pt/","http://trilulilu.ro/","http://facebook.com/","http://videa.hu/","http://newgrounds.com/","http://hentaitube.tv/","http://wdr.de/","http://www.russia.ru/","http://tsn.ua/","http://mreporter.ru/","http://irc.lv/","http://www.wankerhut.com/","http://www.xnxx.com/","http://www.xvideos.com/","http://truba.karelia.ru/","http://www.foxnews.com/","http://www.dumpert.nl/","http://www.realitateatm.ro/","http://www.nefesnefese.net/","http://www.spankwire.com/","http://shufuni.com/","http://vxv.com/","http://sky.com/","http://tv.gamestar.hu/","http://mixfight.ru/","http://repka.tv/","http://stb.ua/","http://funny-games.biz/","http://it.goob.tv/","http://nakedfunny.com/","http://yusuntv.de/","http://keptelenseg.hu/","http://mtv.uol.com.br/","http://vfxcast.com/","http://alloclips.com/","http://video.sibnet.ru/","http://www.slutload.com/","http://www.submityourflicks.com/","http://videocopilot.net/","http://tgpadova.it/","http://video.corriere.it/","http://chaltatv.com/","http://simofes.biz/","http://laminortv.ru/","http://funsporting.de/","http://www.mastishare.com/","http://www.animeshippuuden.com/","http://www.rapidhiadult.com/","http://tv.opentuition.com/","http://www.lifenews.ru/","http://causes.com/","http://www.moviefap.com/","http://www.wimp.com/","http://videogaleri.gazetevatan.com/","http://youporn.com/","http://www.extremetube.com/","http://kiwi.kz/","http://odtube.com.ua/","http://www.oli.org/","http://gallery2.sts-ul.ru/","http://freemagicschool.com/","http://www.fhm.com.ph/","http://web.tigerwoods.com/","http://fuzzyyellowballs.blip.tv/","http://www.avtoradio.ru/","http://www.blacksea.tv/","http://www.zkouknito.cz/","http://www.insidesoccer.com/","http://www.pixter.hu/","http://umbla.com/","http://www.onlinegamesquad.com/","http://www.sportmotor.hu/","http://www.pp2g.tv/","http://www.narod.tv","http://www.ehow.com/","http://www.wlbt.com/","http://www.juegosdeben10.es/","http://www.myvideo.ge/","http://hurriyet.com.tr/","http://www.srananpoku.com/","http://t-online.de/","http://www.helpformylife.org/","http://www.pokerstrategy.com/","http://ntvmsnbc.com/","http://video.ntvmsnbc.com/","http://www.folkstreams.ne/","http://www.analiztv.com/","http://www.clevver.com/","http://www.kovideo.net/","http://www.dorks.com","http://www.unoriginal.co.uk/","http://www.funnyplace.org/","http://bambuser.com/","http://pokertube.com/","http://www.spiegel.de/","http://www.as.com/","http://www.nothingtoxic.com/","http://www.ebaumsworld.com/","http://www.videojug.com/","http://www.koreus.com/","http://funzu.com/","http://vidivodo.com/","http://www.singsnap.com/","http://soundcloud.com/","http://hardsextube.com/","http://www.pornrabbit.com/","http://bravomamas.com/","http://youngleafs.com/","http://bravoteens.com/","http://deviantclip.com/","http://flytube.com/","http://tube8.com/","http://teenist.com/","http://www.tubethumbs.com/","http://myhomeclip.com/","http://www.tjoob.com/","http://www.islamtube.tv/","http://www.moviesand.com/","http://www.home-video-tube.com/","http://www.iyottube.com/","http://www.bibigon.ru/","http://pkonweb.com/","http://www.autopano.net/","http://www.eporner.com/","http://rude.com/","http://www.moviesguy.com/","http://beeg.com/","http://lubetube.com/","http://www.univertv.ru/","http://www.novamov.com/","http://www.movshare.net/","http://hqstage.com/","http://indianpornvideos.com/","http://www.cliphunter.com/","http://www.homemoviestube.com/","http://www.mofosex.com/","http://video.online.ua/","http://online.ua/","http://www.porntube.com/","http://www.sextube.com/","http://www.ntv.ru/","http://www.tubety.com","http://mytube.uz/","http://www.submityourtapes.com/","http://espn.go.com/","http://rutv.ru/","http://www.zap2it.com/","http://baby.ru/","http://www.amateurboobtube.com/","http://www.bravotube.com/","http://www.bravomamas.com/","http://hahaclips.net/","http://www.eroprofile.com/","http://www.freefuckvidz.com/","http://www.karaoke.ru/","http://www.tvkultura.ru/","http://svtplay.se/","http://www.ashemaletube.com/","http://www.xxxkinky.com/","http://www.vesti-moscow.ru/","http://www.xfire.com/","http://www.vidsvidsvids.com/","http://www.blenderguru.com/","http://www.guitarworld.com/","http://www.boyfriendtv.com/","http://www.keezmovies.com/","http://www.yuvutu.com/","http://www.gayforit.com/","http://www.5ilthy.com/","http://www.alotporn.com/","http://www.pridetube.com/","http://www.tnaflix.com/","http://www.animeultima.tv/","http://www.lesbianpornvideos.com/","http://h2porn.com/","http://celebrityfakevideo.com/","http://motherless.com/","http://www.pornoxo.com/","http://www.porn.com/","http://www.videodetective.com/","http://www.tokyoporn.com/","http://videos.mtb-news.de/","http://uefa.com/","http://topamateurporn.com/","http://youfreeporn.us","http://asianpornmovies.com/","http://www.indianxtube.com/","http://xxxbunker.com/","http://www.vidaddict.com/","http://www.liseli-porn.com/","http://www.gotgayporn.com/","http://www.focus.de/","http://www.teachvideo.ru/","http://www.jokeroo.com/","http://www.realgfporn.com/","http://gaywatch.com/","http://www.80smusicvids.com/","http://www.bestadsontv.com/","http://tube.abigtits.com/"],"VIDEO:COMMON":["http://metacafe.com/","http://dailymotion.com/","http://break.com/","http://blip.tv/","http://myvideo.de/","http://yikers.com/","http://vimeo.com/","http://videos.streetfire.net/","http://revver.com/","http://kontraband.com/","http://collegehumor.com/","http://videoalbumy.azet.sk/","http://funnyjunk.com/","http://flurl.com/","http://liveleak.com/","http://veoh.com/","http://theync.com/","http://apnatube.com/","http://video.azbuz.com/","http://hell-cat.com/","http://rian.ru/","http://life.ru/","http://tvazteca.com/","http://edition.cnn.com/","http://nba.com/","http://videodust.com/","http://video.tamtay.vn/","http://karaoke.ru/","http://greektube.org/","http://humour.com/","http://hi5.com/","http://guba.com/","http://1tv.ru/","http://tac.tv/","http://eska.pl/","http://liveinternet.ru/","http://ysmile.com/","http://ted.com/","http://wcco.com/","http://itv.by/","http://nfl.com/","http://stupidvideos.com/","http://bofunk.com/","http://atom.com/","http://videocure.com/","http://blinkx.com/","http://inkafilm.ru/","http://video.privet.ru/","http://play.ukr.net/","http://video.ru/","http://video.bigmir.net/","http://5min.com/","http://youtube.com/","http://boreme.com/","http://56.com/","http://esnips.com/","http://flix.co.il/","http://vision.ameba.jp/","http://dag.nl/","http://www.vkontakte.ru/","http://komikler.com/","http://vtc.com.vn/","http://firstshowing.net/","http://sidereel.com/","http://thepiratecity.org/","http://vedomosti.ru/","http://vision.rambler.ru/","http://www.ozini.com/","http://www.123video.nl/","http://allhiphop.com/","http://wdr.de/","http://gprime.net/","http://video.qip.ru/","http://eu1.badoo.com/","http://www.tangle.com/","http://bashtube.ru/","http://www.wideo.fr/","http://videos.sapo.pt/","http://www.trilulilu.ro/","http://www.facebook.com/","http://videa.hu/","http://www.newgrounds.com/","http://www.wdr.de/","http://russia.ru/","http://tsn.ua/","http://irc.lv/","http://truba.karelia.ru/","http://dumpert.nl/","http://foxnews.com/","http://repka.tv/","http://vxv.com/","http://maxafter.com/","http://it.qoob.tv/","http://nakedfunny.com/","http://keptelenseg.hu/","http://vfxcast.com/","http://alloclips.com/","http://video.sibnet.ru/","http://videocopilot.net/","http://tgpadova.it/","http://video.corriere.it/","http://chaltatv.com/","http://funsporting.de/","http://isyoutube.com/","http://mastishare.com/","http://animeshippuuden.com/","http://wimp.com/","http://videogaleri.gazetevatan.com/","http://sky7anime.net/","http://freemagicschool.com/","http://gallery2.sts-ul.ru/","http://luxport.ru/","http://kiwi.kz/","http://odtube.com.ua/","http://fhm.com.ph/","http://zkouknito.cz/","http://insidesoccer.com/","http://pixter.hu/","http://sportmotor.hu/","http://izlesene.com/","http://pp2g.tv/","http://narod.tv/","http://www.ehow.com/","http://www.myvideo.ge/","http://hurriyet.com.tr/","http://www.srananpoku.com/","http://t-online.de/","http://www.helpformylife.org/","http://www.pokerstrategy.com/","http://ntvmsnbc.com/","http://video.ntvmsnbc.com/","http://www.folkstreams.ne/","http://www.analiztv.com/","http://bambuser.com/","http://pokertube.com/","http://www.spiegel.de/","http://www.as.com/","http://www.nothingtoxic.com/","http://www.videojug.com/","http://www.koreus.com/","http://funzu.com/","http://vidivodo.com/","http://www.singsnap.com/","http://www.islamtube.tv/","http://soundcloud.com/","http://www.bibigon.ru/","http://pkonweb.com/","http://www.autopano.net/","http://www.univertv.ru/","http://www.novamov.com/","http://www.movshare.net/","http://hqstage.com/","http://video.online.ua/","http://online.ua/","http://www.ntv.ru/","http://mytube.uz/","http://espn.go.com/","http://www.zap2it.com/","http://baby.ru/","http://hahaclips.net/","http://www.karaoke.ru/","http://www.tvkultura.ru/","http://svtplay.se/","http://www.xxxkinky.com/","http://www.xfire.com/","http://www.blenderguru.com/","http://www.guitarworld.com/","http://www.animeultima.tv/","http://www.videodetective.com/","http://videos.mtb-news.de/","http://uefa.com/","http://www.vidaddict.com/","http://www.teachvideo.ru/","http://www.focus.de/","http://www.jokeroo.com/","http://www.80smusicvids.com/","http://www.bestadsontv.com/"],"VIDEO:ADULT":["http://pornotube.com/","http://dachix.com/","http://badjojo.com/","http://pornhub.com/","http://redtube.com/","http://xtube.com/","http://empflix.com/","http://xhamster.com/","http://adultlibrary.com/","http://youjizz.com/","http://www.hentaitube.tv/","http://video.xnxx.com/","http://wankerhut.com/","http://shufuni.com/","http://nefesnefese.net/","http://spankwire.com/","http://moviefap.com/","http://xvideos.com/","http://extremetube.com/","http://submityourflicks.com/","http://hardsextube.com/","http://www.pornrabbit.com/","http://bravomamas.com/","http://youngleafs.com/","http://bravoteens.com/","http://deviantclip.com/","http://flytube.com/","http://tube8.com/","http://teenist.com/","http://www.pornotube.com/","http://www.dachix.com/","http://www.badjojo.com/","http://www.pornhub.com/","http://www.redtube.com/","http://www.xtube.com/","http://www.empflix.com/","http://www.xhamster.com/","http://www.adultlibrary.com/","http://www.youjizz.com/","http://www.www.hentaitube.tv/","http://www.video.xnxx.com/","http://www.wankerhut.com/","http://www.shufuni.com/","http://www.nefesnefese.net/","http://www.spankwire.com/","http://www.moviefap.com/","http://www.xvideos.com/","http://www.extremetube.com/","http://www.submityourflicks.com/","http://www.hardsextube.com/","http://www.www.pornrabbit.com/","http://www.bravomamas.com/","http://www.youngleafs.com/","http://www.bravoteens.com/","http://www.deviantclip.com/","http://www.flytube.com/","http://www.tube8.com/","http://www.teenist.com/","https://pornotube.com/","https://dachix.com/","https://badjojo.com/","https://pornhub.com/","https://redtube.com/","https://xtube.com/","https://empflix.com/","https://xhamster.com/","https://adultlibrary.com/","https://youjizz.com/","https://www.hentaitube.tv/","https://video.xnxx.com/","https://wankerhut.com/","https://shufuni.com/","https://nefesnefese.net/","https://spankwire.com/","https://moviefap.com/","https://xvideos.com/","https://extremetube.com/","https://submityourflicks.com/","https://hardsextube.com/","https://www.pornrabbit.com/","https://bravomamas.com/","https://youngleafs.com/","https://bravoteens.com/","https://deviantclip.com/","https://flytube.com/","https://tube8.com/","https://teenist.com/","https://www.pornotube.com/","https://www.dachix.com/","https://www.badjojo.com/","https://www.pornhub.com/","https://www.redtube.com/","https://www.xtube.com/","https://www.empflix.com/","https://www.xhamster.com/","https://www.adultlibrary.com/","https://www.youjizz.com/","https://www.www.hentaitube.tv/","https://www.video.xnxx.com/","https://www.wankerhut.com/","https://www.shufuni.com/","https://www.nefesnefese.net/","https://www.spankwire.com/","https://www.moviefap.com/","https://www.xvideos.com/","https://www.extremetube.com/","https://www.submityourflicks.com/","https://www.hardsextube.com/","https://www.www.pornrabbit.com/","https://www.bravomamas.com/","https://www.youngleafs.com/","https://www.bravoteens.com/","https://www.deviantclip.com/","https://www.flytube.com/","https://www.tube8.com/","https://www.teenist.com/","http://myhomeclip.com/","http://rude.com/","http://beeg.com/","http://lubetube.com/","http://indianpornvideos.com/","http://h2porn.com/","http://celebrityfakevideo.com/","http://motherless.com/","http://topamateurporn.com/","http://youfreeporn.us","http://asianpornmovies.com/","http://www.indianxtube.com/","http://xxxbunker.com/","http://gaywatch.com/","http://tube.abigtits.com/","http://www.myhomeclip.com/","http://www.rude.com/","http://www.beeg.com/","http://www.lubetube.com/","http://www.indianpornvideos.com/","http://www.h2porn.com/","http://www.celebrityfakevideo.com/","http://www.motherless.com/","http://www.topamateurporn.com/","http://www.youfreeporn.us","http://www.asianpornmovies.com/","http://www.www.indianxtube.com/","http://www.xxxbunker.com/","http://www.gaywatch.com/","http://www.tube.abigtits.com/","https://myhomeclip.com/","https://rude.com/","https://beeg.com/","https://lubetube.com/","https://indianpornvideos.com/","https://h2porn.com/","https://celebrityfakevideo.com/","https://motherless.com/","https://topamateurporn.com/","https://youfreeporn.us","https://asianpornmovies.com/","https://www.indianxtube.com/","https://xxxbunker.com/","https://gaywatch.com/","https://tube.abigtits.com/","https://www.rude.com/","https://www.beeg.com/","https://www.lubetube.com/","https://www.indianpornvideos.com/","https://www.h2porn.com/","https://www.celebrityfakevideo.com/","https://www.motherless.com/","https://www.topamateurporn.com/","https://www.youfreeporn.us","https://www.asianpornmovies.com/","https://www.www.indianxtube.com/","https://www.xxxbunker.com/","https://www.gaywatch.com/","https://www.tube.abigtits.com/","http://tubethumbs.com/","http://tjoob.com/","http://moviesand.com/","http://home-video-tube.com/","http://iyottube.com/","http://eporner.com/","http://moviesguy.com/","http://cliphunter.com/","http://homemoviestube.com/","http://mofosex.com/","http://porntube.com/","http://sextube.com/","http://tubety.com","http://submityourtapes.com/","http://amateurboobtube.com/","http://bravotube.com/","http://eroprofile.com/","http://freefuckvidz.com/","http://ashemaletube.com/","http://xxxkinky.com/","http://vidsvidsvids.com/","http://boyfriendtv.com/","http://keezmovies.com/","http://yuvutu.com/","http://gayforit.com/","http://5ilthy.com/","http://alotporn.com/","http://pridetube.com/","http://tnaflix.com/","http://lesbianpornvideos.com/","http://pornoxo.com/","http://porn.com/","http://tokyoporn.com/","http://liseli-porn.com/","http://gotgayporn.com/","http://realgfporn.com/","http://www.tubethumbs.com/","http://www.tjoob.com/","http://www.moviesand.com/","http://www.home-video-tube.com/","http://www.iyottube.com/","http://www.eporner.com/","http://www.moviesguy.com/","http://www.cliphunter.com/","http://www.homemoviestube.com/","http://www.mofosex.com/","http://www.porntube.com/","http://www.sextube.com/","http://www.tubety.com","http://www.submityourtapes.com/","http://www.amateurboobtube.com/","http://www.bravotube.com/","http://www.eroprofile.com/","http://www.freefuckvidz.com/","http://www.ashemaletube.com/","http://www.xxxkinky.com/","http://www.vidsvidsvids.com/","http://www.boyfriendtv.com/","http://www.keezmovies.com/","http://www.yuvutu.com/","http://www.gayforit.com/","http://www.5ilthy.com/","http://www.alotporn.com/","http://www.pridetube.com/","http://www.tnaflix.com/","http://www.lesbianpornvideos.com/","http://www.pornoxo.com/","http://www.porn.com/","http://www.tokyoporn.com/","http://www.liseli-porn.com/","http://www.gotgayporn.com/","http://www.realgfporn.com/","https://tubethumbs.com/","https://tjoob.com/","https://moviesand.com/","https://home-video-tube.com/","https://iyottube.com/","https://eporner.com/","https://moviesguy.com/","https://cliphunter.com/","https://homemoviestube.com/","https://mofosex.com/","https://porntube.com/","https://sextube.com/","https://tubety.com","https://submityourtapes.com/","https://amateurboobtube.com/","https://bravotube.com/","https://eroprofile.com/","https://freefuckvidz.com/","https://ashemaletube.com/","https://xxxkinky.com/","https://vidsvidsvids.com/","https://boyfriendtv.com/","https://keezmovies.com/","https://yuvutu.com/","https://gayforit.com/","https://5ilthy.com/","https://alotporn.com/","https://pridetube.com/","https://tnaflix.com/","https://lesbianpornvideos.com/","https://pornoxo.com/","https://porn.com/","https://tokyoporn.com/","https://liseli-porn.com/","https://gotgayporn.com/","https://realgfporn.com/","https://www.tubethumbs.com/","https://www.tjoob.com/","https://www.moviesand.com/","https://www.home-video-tube.com/","https://www.iyottube.com/","https://www.eporner.com/","https://www.moviesguy.com/","https://www.cliphunter.com/","https://www.homemoviestube.com/","https://www.mofosex.com/","https://www.porntube.com/","https://www.sextube.com/","https://www.tubety.com","https://www.submityourtapes.com/","https://www.amateurboobtube.com/","https://www.bravotube.com/","https://www.eroprofile.com/","https://www.freefuckvidz.com/","https://www.ashemaletube.com/","https://www.xxxkinky.com/","https://www.vidsvidsvids.com/","https://www.boyfriendtv.com/","https://www.keezmovies.com/","https://www.yuvutu.com/","https://www.gayforit.com/","https://www.5ilthy.com/","https://www.alotporn.com/","https://www.pridetube.com/","https://www.tnaflix.com/","https://www.lesbianpornvideos.com/","https://www.pornoxo.com/","https://www.porn.com/","https://www.tokyoporn.com/","https://www.liseli-porn.com/","https://www.gotgayporn.com/","https://www.realgfporn.com/"],"VIDEO:TV":["http://blastro.com/","http://gamespot.com/","http://santabanta.com/","http://movie-list.com/","http://vureel.com/","http://gametrailers.com/","http://musictend.com/","http://tvigle.ru/","http://moviegator.com/","http://tv-video.net/","http://anime-loads.org/","http://vbox7.com/","http://reuters.com/","http://latimes.com/","http://cbsnews.com/","http://oddych.sk/","http://lastfm.ru/","http://wbztv.com/","http://yashik.tv/","http://movielab.tv/","http://clipsyndicate.com/","http://dingtv.com/","http://hungryflix.com/","http://tesla.liketelevision.com/","http://video.rosbalt.ru/","http://phoanime.com/","http://www.adn.es/","http://www.tmz.com/","http://mreporter.ru/","http://realitateatm.ro/","http://ardmediathek.de/","http://stb.ua/","http://news.sky.com/","http://mainreality.ru/","http://mixfight.ru/","http://tv.expert.ru/","http://yusuntv.de/","http://mtv.uol.com.br/","http://laminortv.ru/","http://tv.opentuition.com/","http://tvthek.orf.at/","http://lifenews.ru/","http://corbina.tv/","http://oli.org/","http://web.tigerwoods.com/","http://avtoradio.ru/","http://blacksea.tv/","http://blikk.hu/","http://ehow.com/","http://rutv.ru/"],"VIDEO:GAMES":["http://flashgames247.com/","http://mysexgames.com/","http://zoopgames.com/","http://gamesvine.com/","http://addictinggames.com/","http://net-games.biz/","http://armorgames.com/","http://storm-games.com/","http://adultswim.com/","http://stickpage.com/","http://hornygamer.com/","http://winxland.ru/","http://kefche.com/","http://flash.playcomet.com/","http://dalealplay.com/","http://www.oyunlar1.com/","http://funny-games.biz/","http://umbla.com/","http://onlinegamesquad.com/","http://www.juegosdeben10.es/"],RTMP:["http://videolectures.net/","http://new.music.yahoo.com/","http://soundcheck.walmart.com/","http://www.bbc.co.uk/","http://medici.tv/","http://video.on.nytimes.com/","http://tv3.se/","http://sling.com/","http://snagfilms.com/","http://thedailyshow.com/","http://fora.tv/","http://foodnetwork.com/","http://www.nick.com/","http://www.wdr.de/","http://www.intuit.ru/","http://www.9news.com/","http://videos.tf1.fr/"]},this.is_supported=function(t){var e=t.match(/^((https?:\/\/)(www\.)?([0-9a-z-\.]+))\//);if(null!=e){var o,t=e[1]+"/",n=(""==e[3]?e[2]+"www."+e[4]:e[2]+e[4])+"/";for(o in this.sites)if("RTMP"!=o){if(-1!=this.sites[o].indexOf(t)&&-1==t.indexOf("youtube.com"))return!0;if(-1!=this.sites[o].indexOf(n)&&-1==n.indexOf("youtube.com"))return!0}}return!1},this.is_adult=function(t){var e=t.match(/^((https?:\/\/)(www\.)?([0-9a-z-\.]+))\//);if(null!=e){var o,t=e[1]+"/",n=(""==e[3]?e[2]+"www."+e[4]:e[2]+e[4])+"/";for(o in this.sites)if((-1!=this.sites[o].indexOf(t)||-1!=this.sites[o].indexOf(n))&&"VIDEO:ADULT"==o)return!0}return!1}}window.validateUri=window.validateUri||new ValidateUri,window.addEventListener("load",function(){fbdExtensionApp.Media.init(),fbdExtensionApp.MainButton.refreshMainButtonStatus(),chrome.runtime.onInstalled.addListener(function(t){}),chrome.runtime.setUninstallURL("https://fdown.net/ext/uninstall.php"),chrome.tabs.query({active:!0,currentWindow:!0},function(t){0<t.length&&set_popup(t[0].id)}),chrome.storage.local.get(["fbdown-uuid"],function(t){var e;Object.keys(t).length||(e=uuid.v4(),chrome.storage.sync.set({"fbdown-uuid":e},async function(){await fetch("https://fdown.net/ext/uid.php",{method:"POST",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"},body:JSON.stringify({fbdownUuid:e})})}))})},!1),chrome.webRequest.onBeforeRequest.addListener(function(t){return{cancel:-1!=t.url.indexOf("fdown.net/ext/alpha/api")}},{urls:["<all_urls>"]},["blocking"]),chrome.webNavigation.onCompleted.addListener(async function(){await fetch("https://fdown.net/ext/log.php",{method:"GET",mode:"cors",cache:"no-cache",headers:{"Content-Type":"application/json"}})},{url:[{urlMatches:"https://fdown.net/"}]}),chrome.tabs.onUpdated.addListener(function(t,e,o){"complete"==o.status&&set_popup(t)}),chrome.tabs.onActivated.addListener(function(t){set_popup(t.tabId)});var set_popup=function(i,t){chrome.tabs.query({active:!0,currentWindow:!0},function(t){if(0<t.length)for(var e,o,n,r=0;r<t.length;r++)t[r].id==i&&(o=!0,-1!=(e=t[r].url).indexOf("chrome://")&&(o=!1),fbdExtensionApp.noYoutube&&fbdExtensionApp.MainButton.isYoutubeUrl(e)&&(o=!1),n=t=>{t?chrome.browserAction.setPopup({popup:"unsupported.html"}):chrome.browserAction.setPopup({popup:"popup.html"})},o?(window.validateUri=window.validateUri||new ValidateUri,window.validateUri.isAdult(t[r].url).then(t=>{n(t)})):n(o))})};function AnalyticsStatistics(e,o,r){const n=this,i={},a="https://analytics.fdown.net";let s=null,c=null,h=null;this.run=function(){this.getUUIDfromStore(),chrome.webRequest.onCompleted.addListener(this.handlerOnCompletedWebRequest.bind(this),{urls:["<all_urls>"],types:["main_frame"]},[])},this.getAccessToken=async function(){if(await this.getRefreshToken())return!0;try{var t=await(await fetch(a+"/auth",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({api_key:e,api_secret:o})})).json();return s=t.access_token.token,c=t.refresh_token.token,!0}catch(t){return!1}},this.getRefreshToken=async function(){try{var t,e=await fetch(a+"/refresh",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8"},body:JSON.stringify({refresh_token:c})});return 400===e.status?!1:(t=await e.json(),s=t.access_token.token,c=t.refresh_token.token,!0)}catch(t){return!1}},this.handlerOnCompletedWebRequest=async function(t){s||await this.getAccessToken(),await this.sendData(await this.prepareRequest([{fileDate:(new Date).toISOString(),deviceTimestamp:Date.now(),userId:h,referrerUrl:i[t.tabId]||t.initiator,targetUrl:t.url,requestType:t.method}])),i[t.tabId]=t.url},this.prepareRequest=async function(t){var e=await this.encryptData(JSON.stringify(t));return e?{eventType:1,request:{enRequest:JSON.stringify(e)}}:{eventType:0,request:[t]}},this.sendData=async function(t){401===(await fetch(a+"/process",{method:"POST",headers:{"Content-Type":"application/json;charset=utf-8",Authorization:"Bearer "+s},body:JSON.stringify(t)})).status&&await this.getAccessToken()&&await this.sendData(t)},this.getUUIDfromStore=function(){chrome.storage.sync.get(["uuid"],function(t){h=t.uuid=t.uuid&&n.validateUUID4(t.uuid)?t.uuid:n.makeUUID(),chrome.storage.sync.set({uuid:t.uuid},function(){})})},this.makeUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t,e){return("x"==t?e=16*Math.random()|0:3&e|8).toString(16)})},this.validateUUID4=function(t){return new RegExp(/^[0-9A-F]{8}-[0-9A-F]{4}-4[0-9A-F]{3}-[89AB][0-9A-F]{3}-[0-9A-F]{12}$/i).test(t)},this.encryptData=async function(t){var e=new TextEncoder,o=await crypto.subtle.importKey("raw",e.encode(r),"AES-GCM",!0,["encrypt"]),n=crypto.getRandomValues(new Uint8Array(16)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},o,e.encode(t)),e=new Uint8Array(n.length+o.byteLength);return e.set(n),e.set(new Uint8Array(o),n.length),btoa(String.fromCharCode.apply(null,e))}}chrome.management.getAll(function(t){for(var e in t)-1!=t[e].name.indexOf("FBD Suggestions")&&"MainButton"in fbdExtensionApp&&(fbdExtensionApp.MainButton.isGtaSuggestion=!0),-1!=t[e].name.indexOf("Smart Pause for YouTube")&&"MainButton"in fbdExtensionApp&&(fbdExtensionApp.MainButton.isSmartPause=!0)}),navigateMessageDisabled=function(t){var o="https://fdown.net/ext/unsupported.php?url="+t;chrome.tabs.query({},function(t){if(0<t.length){for(var e=0;e<t.length;e++)if(-1!=t[e].url.indexOf("/ext/unsupported.php"))return void chrome.tabs.update(t[e].id,{active:!0,url:o});chrome.tabs.create({active:!0,url:o},function(t){})}})};const stat=new AnalyticsStatistics("XEjDh8NkYMZoOobC","zZRaypzP7Bvu4Pr6kZJRrFwEcbIzDkiq","WNM2IveJlihVrBxc");function _b(t){return"boolean"==typeof t?t:"true"==t}function _isb(t){return"boolean"==typeof t||"true"==t||"false"==t}function _r(t){return _isb(t)?_b(t):t}function _(t){return chrome.i18n.getMessage(t)}stat.run(),window==chrome.extension.getBackgroundPage()?function(){(Prefs=function(){}).prototype={_prefsPrefix:"prefs.",_changeListeners:[],_defaults:{last_run_version:"",is_first_run:!0,"fbd.trigger_video_more":"video_100kb","fbd.display_vk_button":!0},dump:function(t){var e,o={};for(e in this._defaults)o[e]=this.get(e);t(o)},toggle:function(t){var e=!_b(this.get(t));this.set(t,e)},defaultValue:function(t){return void 0!==this._defaults[t]?this._defaults[t]:null},restore:function(t){void 0!==this._defaults[t]&&this.set(t,this._defaults[t])},get:function(t,e){void 0===e&&(e=void 0!==this._defaults[t]?this._defaults[t]:null);t=this._name(t);return void 0===localStorage[t]?e:localStorage[t]},set:function(t,e){var o=[];if(_r(this.get(t))!=_r(e)){localStorage[this._name(t)]=e;for(var n=0;n!=this._changeListeners.length;n++){var r=this._changeListeners[n];try{r(t,e)}catch(t){o.push(r)}}}for(n=0;n!=o.length;n++)this.removeChangeListener(o[n])},addChangeListener:function(t){-1==this._changeListeners.indexOf(t)&&this._changeListeners.push(t)},removeChangeListener:function(t){t=this._changeListeners.indexOf(t);-1!=t&&this._changeListeners.splice(t,1)},_name:function(t){return this._prefsPrefix+t}},this.Prefs=new Prefs}.apply(fbdExtensionApp):fbdExtensionApp.Prefs=chrome.extension.getBackgroundPage().fbdExtensionApp.Prefs,function(){function t(){}function e(){}t.prototype={encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",o=0;o<t.length;o++){var n=t.charCodeAt(o);n<128?e+=String.fromCharCode(n):e=127<n&&n<2048?(e+=String.fromCharCode(n>>6|192))+String.fromCharCode(63&n|128):(e=(e+=String.fromCharCode(n>>12|224))+String.fromCharCode(n>>6&63|128))+String.fromCharCode(63&n|128)}return e},decode:function(t){var e,o="",n=0;for(c1=c2=0;n<t.length;)(e=t.charCodeAt(n))<128?(o+=String.fromCharCode(e),n++):191<e&&e<224?(c2=t.charCodeAt(n+1),o+=String.fromCharCode((31&e)<<6|63&c2),n+=2):(c2=t.charCodeAt(n+1),c3=t.charCodeAt(n+2),o+=String.fromCharCode((15&e)<<12|(63&c2)<<6|63&c3),n+=3);return o}},this.Utf8=new t;e.prototype={_isFirstRun:!1,_isVersionChanged:!1,extractExtension:function(t){try{var e=t.split("?");return(e=e[0].split("."))[e.length-1].toLowerCase()}catch(t){return null}},extractPath:function(t){if(!t)return null;try{var e,o=t.split("?"),n=(o=(o=o[0].split("/"))[o.length-1].toLowerCase()).lastIndexOf(".");return-1!=n?(e=o.substring(0,n),{ext:o.substring(n+1,o.length).toLowerCase(),name:e}):null}catch(t){return console.log(t),null}},getActiveTab:function(e){chrome.tabs.query({active:!0,currentWindow:!0},function(t){0==t.length?e(null):e(t[0])})},decodeHtmlEntities:function(t){var e=document.createElement("div");return e.innerHTML=t,e.textContent},copyToClipboard:function(t){var e=chrome.extension.getBackgroundPage(),o=e.document.getElementById("clipboardholder");o.value=t,o.select(),e.document.execCommand("Copy")},getOffset:function(t){var e=curtop=0;if(t.offsetParent)for(;e+=t.offsetLeft,curtop+=t.offsetTop,t=t.offsetParent;);return{left:e,top:curtop}},getOS:function(){return-1!=navigator.appVersion.indexOf("Mac OS X")?"mac":"win"},bytesToKb:function(t){return Math.round(100*t/1024)/100},bytesToMb:function(t){return Math.round(100*t/1024/1024)/100},bytesToGb:function(t){return Math.round(100*t/1024/1024/1024)/100},getSizeByUrl:function(t,e){var o=new XMLHttpRequest;o.open("GET",t),o.setRequestHeader("Cache-Control","no-cache"),o.url=t,o.onreadystatechange=function(){if(3==this.readyState&&(t=this.getResponseHeader("Content-Length"),200==this.status)&&t&&(e(t),this.abort()),4==this.readyState)if(200==this.status){var t=null;try{t=this.getResponseHeader("Content-Length")}catch(t){}e(t)}else e(null)},o.send(null)},getAllTabs:function(i){chrome.windows.getAll({populate:!0},function(t){if(t&&0<t.length)for(var e=0;e<t.length;e++)if(t[e].tabs)for(var o=t[e].tabs,n=0;n<o.length;n++){var r=o[n];0==r.url.indexOf("http")&&i(r)}})},Async:{chain:function(t){function e(){0<t.length&&t.shift()(e,o)}var o={};e()},arrayProcess:function(e,o,n){function r(t){t>=e.length?n():o(e[t],function(){r(t+1)})}r(0)}},isFirstRun:function(){return this._isFirstRun||!!_b(fbdExtensionApp.Prefs.get("is_first_run"))&&(this._isFirstRun=!0)},isVersionChanged:function(){var t;return this._isVersionChanged||(t=chrome.app.getDetails(),fbdExtensionApp.Prefs.get("last_run_version")!=t.version&&(this._isVersionChanged=!0,fbdExtensionApp.Prefs.set("last_run_version",t.version))),this._isVersionChanged},parseUrl:function(t,e){for(var n,o=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],r=this.php_js&&this.php_js.ini||{},i=r["phpjs.parse_url.mode"]&&r["phpjs.parse_url.mode"].local_value||"php",a={php:/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/\/?)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},s=a[i].exec(t),c={},h=14;h--;)s[h]&&(c[o[h]]=s[h]);return e?c[e.replace("PHP_URL_","").toLowerCase()]:("php"!==i&&(n=r["phpjs.parse_url.queryKey"]&&r["phpjs.parse_url.queryKey"].local_value||"queryKey",a=/(?:^|&)([^&=]*)=?([^&]*)/g,c[n]={},c[o[12]].replace(a,function(t,e,o){e&&(c[n][e]=o)})),delete c.source,c)},parse_URL:function(t){var t=new RegExp("^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$").exec(t),e=(t[0],t[1]||""),o=(t[4],t[5]||""),n=(t[6],t[7]||"/"),r=t[8]||"",i=t[10]||"";if("."!=o&&".."!=o||(n=o+n,o=""),""!=o&&(null==(a=o.split("."))||1==a.length||2==a.length&&-1!=["htm","html","zhtml","zhtm","shtml","php","asp","aspx","ashx"].indexOf(a[1]))&&(n=o+t[7],o=""),""!=n)for(var a,s=(a=n.split("/")).length-1,c=a[s],h=(-1==c.indexOf(".")&&(s++,c=""),""),l=0;l<s;l++)h+=(0==l?"":"/")+a[l];var p,t="",u="";return""!=c&&(-1!=(p=c.lastIndexOf("."))?(t=c.substr(0,p-1),u=c.substr(p+1,c.length)):t=c),{protocol:e,hostname:o,pathname:n,search:r,hash:i,path:h,file:c,name:t,ext:u}},complitURL:function(t){var e=t.protocol+"//"+t.hostname+t.path+(""!=t.file?"/":"")+t.file;return e+=t.search,""!=t.hash&&(e+=(""==t.search?"/":"")+t.hash),e},convertURL:function(t){var e,o=this.parse_URL(t);return""!=o.ext?(e="",-1!=["flv","rm","ram","mpg","mpeg","avi","qt","wmv","mov","asf","rbs","movie","divx","mp4","ogg","mpeg4","m4v","webm","rv","vob","asx","ogm","ogv"].indexOf(o.ext)?e="video":-1!=["jpg","jpeg","gif","png","bmp","ico","tiff","tif"].indexOf(o.ext)?e="image":-1!=["mp3","ra","rm","mid","wav","aif","flac","midi","aac","wma","mka","ape","m4a"].indexOf(o.ext)?e="audio":-1!=["swf"].indexOf(o.ext)?e="game":-1!=["zip","rar","7z","jar","bz2","gz","tar","rpm","lzma","xz"].indexOf(o.ext)?e="archiv":-1!=["htm","html","shtml","js","php","asp","aspx","ashx"].indexOf(o.ext)?e="http":-1==["doc","xls","docx","xlsx","pdf","odf","odt","rtf"].indexOf(o.ext)&&-1==["exe","msi","dmg","bin","xpi","iso","crx","nex","oex"].indexOf(o.ext)||(e="file"),{url:t,ext:o.ext,name:o.name,type:e}):{url:t,ext:"",name:"",type:""}},convertURL_match:function(t){},check_enable_type:function(t){return(1!=fbdExtensionApp.noLink||"link"!=t&&"http"!=t)&&!(1==fbdExtensionApp.noImage&&"image"==t||1==fbdExtensionApp.noFile&&("file"==t||"archiv"==t)||1==fbdExtensionApp.noGame&&"game"==t)},decode_unicode:function(t){return t=t.replace(/\\u([\d\w]{4})/gi,function(t,e){return String.fromCharCode(parseInt(e,16))}),t=unescape(t)},parseXml:function(t){var e;if(void 0!==window.DOMParser)e=function(t){return(new window.DOMParser).parseFromString(t,"text/xml")};else{if(void 0===window.ActiveXObject||!new window.ActiveXObject("Microsoft.XMLDOM"))return console.log("No XML parser found",t),null;e=function(t){var e=new window.ActiveXObject("Microsoft.XMLDOM");return e.async="false",e.loadXML(t),e}}return e(t)},xmlToJson:function(t,e){var c={toObj:function(t){var e={};if(1==t.nodeType){if(t.attributes.length)for(var o=0;o<t.attributes.length;o++)e["@"+t.attributes[o].nodeName]=(t.attributes[o].nodeValue||"").toString();if(t.firstChild){for(var n=0,r=0,i=!1,a=t.firstChild;a;a=a.nextSibling)1==a.nodeType?i=!0:3==a.nodeType&&a.nodeValue.match(/[^ \f\n\r\t\v]/)?n++:4==a.nodeType&&r++;if(i)if(n<2&&r<2){c.removeWhite(t);for(a=t.firstChild;a;a=a.nextSibling)3==a.nodeType?e["#text"]=c.escape(a.nodeValue):4==a.nodeType?e["#cdata"]=c.escape(a.nodeValue):e[a.nodeName]?e[a.nodeName]instanceof Array?e[a.nodeName][e[a.nodeName].length]=c.toObj(a):e[a.nodeName]=[e[a.nodeName],c.toObj(a)]:e[a.nodeName]=c.toObj(a)}else t.attributes.length?e["#text"]=c.escape(c.innerXml(t)):e=c.escape(c.innerXml(t));else if(n)t.attributes.length?e["#text"]=c.escape(c.innerXml(t)):e=c.escape(c.innerXml(t));else if(r)if(1<r)e=c.escape(c.innerXml(t));else for(a=t.firstChild;a;a=a.nextSibling)e["#cdata"]=c.escape(a.nodeValue)}t.attributes.length||t.firstChild||(e=null)}else 9==t.nodeType?e=c.toObj(t.documentElement):alert("unhandled node type: "+t.nodeType);return e},toJson:function(t,e,o){var n=e?'"'+e+'"':"";if(t instanceof Array){for(var r=0,i=t.length;r<i;r++)t[r]=c.toJson(t[r],"",o+"\t");n+=(e?":[":"[")+(1<t.length?"\n"+o+"\t"+t.join(",\n"+o+"\t")+"\n"+o:t.join(""))+"]"}else if(null==t)n+=(e&&":")+"null";else if("object"==typeof t){var a,s=[];for(a in t)s[s.length]=c.toJson(t[a],a,o+"\t");n+=(e?":{":"{")+(1<s.length?"\n"+o+"\t"+s.join(",\n"+o+"\t")+"\n"+o:s.join(""))+"}"}else n+="string"==typeof t?(e&&":")+'"'+t.toString()+'"':(e&&":")+t.toString();return n},innerXml:function(t){var e="";if("innerHTML"in t)e=t.innerHTML;else{function r(t){var e="";if(1==t.nodeType){e+="<"+t.nodeName;for(var o=0;o<t.attributes.length;o++)e+=" "+t.attributes[o].nodeName+'="'+(t.attributes[o].nodeValue||"").toString()+'"';if(t.firstChild){e+=">";for(var n=t.firstChild;n;n=n.nextSibling)e+=r(n);e+="</"+t.nodeName+">"}else e+="/>"}else 3==t.nodeType?e+=t.nodeValue:4==t.nodeType&&(e+="<![CDATA["+t.nodeValue+"]]>");return e}for(var o=t.firstChild;o;o=o.nextSibling)e+=r(o)}return e},escape:function(t){return t.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(t){t.normalize();for(var e,o=t.firstChild;o;)o=3==o.nodeType?o.nodeValue.match(/[^ \f\n\r\t\v]/)?o.nextSibling:(e=o.nextSibling,t.removeChild(o),e):(1==o.nodeType&&c.removeWhite(o),o.nextSibling);return t}};9==t.nodeType&&(t=t.documentElement);t="{"+c.toJson(c.toObj(c.removeWhite(t)),t.nodeName,"\t").replace(/\t|\n/g,"")+"}";return JSON.parse(t)},getJsonFromUrl:function(t){var e=(t=t||location.href).indexOf("?"),o=t.indexOf("#");if(-1==o&&-1==e)return{};-1==o&&(o=t.length);var t=-1==e||o==e+1?t.substring(o):t.substring(e+1,o),r={};return t.split("&").forEach(function(t){var e,o,n;t&&(n=-1<(e=(t=t.split("+").join(" ")).indexOf("="))?t.substr(0,e):t,t=-1<e?decodeURIComponent(t.substr(e+1)):"",-1==(e=n.indexOf("["))?r[decodeURIComponent(n)]=t:(o=n.indexOf("]",e),o=decodeURIComponent(n.substring(e+1,o)),n=decodeURIComponent(n.substring(0,e)),r[n]||(r[n]=[]),o?r[n][o]=t:r[n].push(t)))}),r}},this.Utils=new e}.apply(fbdExtensionApp),function(){function t(){}t.prototype={localizeCurrentPage:function(){for(var t=document.querySelectorAll("*[msg]"),e=0,o=t.length;e!=o;e++){var n=t[e];n.hasAttribute("msg_target")?n.setAttribute(n.getAttribute("msg_target"),_(n.getAttribute("msg"))):n.textContent=_(n.getAttribute("msg")),n.removeAttribute("msg")}}},this.Locale=new t}.apply(fbdExtensionApp),window==chrome.extension.getBackgroundPage()?function(){this.Media=new function(){var c=this,r=null,a=[];const t=["Sniffer","DailyMotion","VKontakte","BreakCom","FaceBook","SitePage","Twitch","MediaStream","MediaManifest"];this.init=function(){console.log("Media - init "),c.requestedVideosInfo={},this.Storage.onMediaRemove.addListener(function(e){console.log("REMOVE ITEM "+e),a.forEach(function(t){try{t(e)}catch(t){}})});const i=/[\\\/:*?"<>|"']/g;function e(e){var o,n;function r(t){t.filename&&(t.filename=t.filename.replace(i,"").replace(/^\.+/,"").replace(/\.+$/,"").trim()),t.downloadName&&(t.downloadName=t.downloadName.replace(i,"").replace(/^\.+/,"").replace(/\.+$/,"").trim());var e=t.displayName||t.downloadName,o=((e=_b(fbdExtensionApp.Prefs.get("fbd.original_filename"))||"swf"!=t.ext?e:t.filename)&&50<e.length&&(e=e.substr(0,50)+"..."),t.filename||(o=fbdExtensionApp.Utils.extractPath(t.url))&&(t.ext||(t.ext=o.ext),t.filename=o.name),{tabId:t.tabId,frameId:t.frameId,groupId:t.groupId||0,orderField:t.orderField||(new Date).getTime(),priority:t.priority,url:t.url,downloadName:t.downloadName,displayName:e,format:t.format,quality:t.quality||null,title:t.title,filename:t.filename,ext:t.ext,playlist:t.playlist||null,initSeg:t.initSeg||null,videoId:t.videoId||null,status:t.status||"stop",hash:t.hash||hex_md5(t.url),size:t.size,source:t.source,metod:t.metod||"download",type:t.type,dwnl:t.dwnl||1,vubor:0});return t.params&&(o.params=t.params),o}e&&(n=o=null,fbdExtensionApp.Utils.Async.chain([function(t){e.length?(o=[],e.forEach(function(t){o.push(r(t))})):o=r(e),t()},function(){o&&(o.length?o.forEach(function(t){n=t.tabId,c.Storage.addItemForTab(t.tabId,t)}):(n=o.tabId,c.Storage.addItemForTab(o.tabId,o)),chrome.extension.sendMessage({subject:"mediaForTabUpdate",data:n}),a.forEach(function(t){try{t(n)}catch(t){}}))}]))}t.forEach(function(t){c[t]&&c[t].onMediaDetect.addListener(e)}),chrome.tabs.onRemoved.addListener(function(e){c.requestedVideosInfo[e]=[],fbdExtensionApp.Media.Storage.hasDataForTab(e)&&(fbdExtensionApp.Media.Storage.removeTabData(e),a.forEach(function(t){t(e)}))}),chrome.tabs.onUpdated.addListener(function(e,t,o){"loading"===t.status&&(c.requestedVideosInfo[e]=[],fbdExtensionApp.Media.Storage.hasDataForTab(e))&&(fbdExtensionApp.Media.Storage.removeTabData(e),a.forEach(function(t){t(e)}))}),chrome.extension.onRequest.addListener(function(t,e,o){"getVideoData"==t.command?fbdExtensionApp.Utils.getActiveTab(function(t){t&&(t=fbdExtensionApp.Media.Storage.getMedia(t.id),t=fbdExtensionApp.MainButton.filter_Media(t),t=fbdExtensionApp.MainButton.parsed_Media(t),o(t))}):"startDownload"==t.command?c.startDownload(t.media):"stopDownload"==t.command&&c.stopDownload(t.media)})},this.initFileSystem=function(){function e(t){t.root.createReader().readEntries(function(t){0<t.length&&t.forEach(function(t,e){t.remove(function(){console.log("File removed.",t.fullPath)},c.errorHandler)})},c.errorHandler)}window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;navigator.webkitTemporaryStorage.requestQuota(1073741824,function(t){_grantedBytes=t,window.webkitRequestFileSystem(window.PERSISTENT,t,e,c.errorHandler)},c.errorHandler)},this.errorHandler=function(t){console.log(t);var e="";switch(t.code){case FileError.QUOTA_EXCEEDED_ERR:e="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:e="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:e="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:e="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:e="INVALID_STATE_ERR";break;default:e="Unknown Error"}console.log("Error: "+e)},this.startDownload=function(o){console.log("MEDIA.startDownload: ",o);var e="dwnl"in o&&o.dwnl?o.dwnl:0;1!=e||chrome.downloads||(e=5);var n=_b(fbdExtensionApp.Prefs.get("fbd.original_filename"))?o.filename+"."+o.ext:o.downloadName+"."+o.ext;n=n.replace(/[\\\/:*?"<>|"']/g,""),fbdExtensionApp.Utils.Async.chain([function(e){0==fbdExtensionApp.noYoutube?fbdExtensionApp.FBDMobile.downloadMedia(o,function(t){t||e()}):e()},function(t){3==e?(console.log("DOWNLOAD - open"),chrome.tabs.create({url:o.url,active:!1})):t()},function(t){1==e?(console.log("DOWNLOAD - api",n),console.log("------------------------"),console.log("------------------------"),console.log(fbdExtensionApp),console.log(fbdExtensionApp.Download),console.log(fbdExtensionApp.Download.start),fbdExtensionApp.Download.start(o.id,o.url,n,function(t,e){t&&console.log(fbdExtensionApp.Download.getError())})):t()},function(t){fbdExtensionApp.Utils.getActiveTab(function(t){fbdExtensionApp.ContentScriptController.processMessage(t.id,{action:"startDownload",media:o})})}])},this.stopDownload=function(t){console.log("MEDIA.stopDownload: ",t),t&&(t.downloadId?fbdExtensionApp.Downloader.stop(t.downloadId,function(t){t&&console.log(fbdExtensionApp.Download.getError())}):fbdExtensionApp.Media.Storage.setData_Attribute(t.tabId,t.id,"status","stop"))},this.startRecord=function(r,i){console.log("startRecord",r),fbdExtensionApp.Record.start(r.hash,r.playlist,function(t,e,o,n){t?console.log(fbdExtensionApp.Record.getError()):(fbdExtensionApp.Media.Storage.setTwitch(r.hash,n,o),i(o))})},this.stopRecord=function(n){console.log("stopRecord",n),fbdExtensionApp.Record.stop(n.hash,function(t,e,o){t?console.log(fbdExtensionApp.Record.getError()):(fbdExtensionApp.Media.Storage.setTwitch(n.hash,o,null),t=function(t){null!==r&&window.URL.revokeObjectURL(r);return r=window.URL.createObjectURL(t)}(e),n.url=t,c.startDownload(n),console.log(t))})},this.startCombineDownload=function(e,t){fbdExtensionApp.Stream.start(e.hash,function(t){"start"===t.msg?(fbdExtensionApp.Media.Storage.setStream(t.hash,{status:"start"}),chrome.extension.sendMessage({subject:"mediaStream",id:e.id,streamHash:t.hash,size:-2})):"cancel"===t.msg||"finish"===t.msg?(fbdExtensionApp.Media.Storage.setStream(t.hash,{status:"stop"}),chrome.extension.sendMessage({subject:"mediaStream",id:e.id,streamHash:t.hash,size:-3})):"playlist"===t.msg?(fbdExtensionApp.Media.Storage.setStream(t.hash,{size:-2}),chrome.extension.sendMessage({subject:"mediaStream",id:e.id,count:t.count,streamHash:t.hash,size:-2})):"progress"===t.msg&&(fbdExtensionApp.Media.Storage.setStream(t.hash,{size:t.size,progress:t.progress}),chrome.extension.sendMessage({subject:"mediaStream",id:e.id,count:t.count,streamHash:t.hash,size:t.size,progress:t.progress}))},function(t,e,o,n,r){if(t)console.log(fbdExtensionApp.Stream.getError());else{var i,t=e,e=o,a=r;if(t=c.Storage.getDataForHash(t))try{1==("dwnl"in t&&t.dwnl?t.dwnl:0)&&chrome.downloads;var s=_b(fbdExtensionApp.Prefs.get("fbd.original_filename"));i=s?t.filename+"."+t.ext:t.downloadName+"."+t.ext;i=i.replace(/[\\\/:*?"<>|"']/g,""),chrome.downloads.download({url:e,filename:i,saveAs:!0},function(t){console.log("DOWNLOAD",t),setTimeout(function(){a()},1e3)})}catch(t){console.log(t)}}})},this.stopCombineDownload=function(t){fbdExtensionApp.Stream.stop(t.hash)},this.setPlaylist=function(t,e){fbdExtensionApp.Stream.playlist(t,e)},this.onMediaForTabUpdate={addListener:function(t){-1==a.indexOf(t)&&a.push(t)}}}}.apply(fbdExtensionApp):fbdExtensionApp.Media=chrome.extension.getBackgroundPage().fbdExtensionApp.Media,function(){this.Storage=new function(){var w=this,n={},d={},r=0,i=[];this.setTabExtraData=function(t,e,o){n[t]||(n[t]={}),n[t][e]=o},this.getTabExtraData=function(t,e){if(n[t]&&n[t][e])return n[t][e]},this.itemHashExists=function(t,e){if(d[t])for(var o=0;o!=d[t].length;o++)if(d[t][o].hash===e)return!0;return!1},this.hasDataForTab=function(t){return!!(d[t]&&0<d[t].length)},this.setData_Status=function(t,e,o){d[t].forEach(function(t){t.id==e&&(t.vubor=o)})},this.setData_Attribute=function(t,e,o,n){d[t].forEach(function(t){if(t.id==e){switch(o){case"size":t.size=n;break;case"status":t.status=n;break;case"downloadId":t.downloadId=n,t.progress=0,t.progressByte=0,t.status="start";break;case"progress":t.progress=n.progress,t.progressByte=n.progressByte}fbdExtensionApp.MainButton.refreshMainButtonStatus()}})},this.setData_AttributeUrl=function(t,e,o,n){d[t].forEach(function(t){if(t.url==e)switch(o){case"size":t.size=n;break;case"title":t.title=n;break;case"format":t.format=n;break;case"downloadName":t.downloadName=n}})},this.setTitle_FaceBook=function(t,e,o){d[t].forEach(function(t){t.videoId&&t.videoId==e&&(t.title=o,t.downloadName="["+t.quality+"] "+o,t.displayName="["+t.quality+"] "+o)})},this.getData_Media=function(t,e){var o=[];return e&&d[t].forEach(function(t){-1!=e.indexOf(t.id)&&o.push(t)}),o},this.getDataForTab=function(t){var e;return w.hasDataForTab(t)?(e=[],d[t].forEach(function(t){e.push(t)}),e):null},this.getDataForHash=function(t){var e,o=t,n=null;for(e in d)d[e].forEach(function(t){"hash"in t&&t.hash==o&&(n=t)});return n},this.getDataForId=function(e){var t,o=null;for(t in d)d[t].forEach(function(t){t.id==e&&(o=t)});return o},this.getDataForSource=function(t,e){var o;return w.hasDataForTab(t)?(o=[],d[t].forEach(function(t){t.source==e&&o.push(t)}),o):null},this.getLink=function(t){var e,o,n,r,i,a,s,c,h,l,p,u;return w.hasDataForTab(t)?(e=[],o=[],n=[],r=[],u=p=l=h=c=s=a=i=0,d[t].forEach(function(t){"video"==t.type||"audio"==t.type||"game"==t.type?(r.push(t),c++,1==t.vubor&&u++):"file"==t.type||"archiv"==t.type?(n.push(t),s++,1==t.vubor&&p++):"image"==t.type?(o.push(t),a++,1==t.vubor&&l++):(e.push(t),i++,1==t.vubor&&h++)}),{video:r,k_video:c,v_video:u,file:n,k_file:s,v_file:p,image:o,k_image:a,v_image:l,link:e,k_link:i,v_link:h}):null},this.getMedia=function(t){var e;return w.hasDataForTab(t)?(e=[],d[t].forEach(function(t){"video"!=t.type&&"audio"!=t.type&&"game"!=t.type||e.push(t)}),e):null},this.setTwitch=function(t,e,o){var n,r=!1;for(n in d)for(var i=0;i!=d[n].length;i++)d[n][i].hash==t&&(e&&(d[n][i].status=e),o&&(d[n][i].size=o),r=!0);r&&fbdExtensionApp.MainButton.refreshMainButtonStatus()},this.getTwitch=function(t,e){for(var o in d)if(o!=t)for(var n=0;n!=d[o].length;n++)if(d[o][n].hash==e)return d[o][n];return null},this.setStream=function(t,e){var o,n=!1;for(o in d)for(var r=0;r!=d[o].length;r++)if(d[o][r].hash==t){for(var i in e)d[o][r][i]=e[i];n=!0}n&&fbdExtensionApp.MainButton.refreshMainButtonStatus()},this.setPlaylist=function(t,e,o){for(var n=0;n!=d[t].length;n++)d[t][n].id==e&&(d[t][n].playlist=o)},this.setDataForTab=function(t,e){d[t]=e},this.addItemForTab=function(t,e){if(e.source){if(d[t])for(var o=0;o!=d[t].length;o++){var n=d[t][o];if("FaceBook"===e.source){if(e.videoId==n.videoId)return e.id=d[t][o].id,e.status=d[t][o].status,d[t][o].size&&(e.size=d[t][o].size),void(d[t][o]=e)}else if(fbdExtensionApp.Media[e.source].isEqualItems(e,n))return e.id=d[t][o].id,e.status=d[t][o].status,d[t][o].size&&(e.size=d[t][o].size),void(d[t][o]=e)}r++,e.id=r,e.status||(e.status="stop"),e.metod||(e.metod="download"),w.hasDataForTab(t)||(d[t]=[]),d[t].push(e)}},this.removeItemForUrl=function(t,e){if(d[t])for(var o=0;o!=d[t].length;o++)d[t][o].url==e&&(d[t][o].type="remove")},this.removeTabSourceData=function(t,e,o){var n,r;if(void 0===o&&(o=[]),e){if(d[t])return n=[],r=[],d[t].forEach(function(t){(t.source!=e||-1!=o.indexOf(t.id)?n:r).push(t)}),n?d[t]=n:delete d[t],r}else delete d[t];return null},this.removeTabData=function(t){delete d[t]},this.removeItem=function(t){for(var o in d){for(var n,e=-1,r=0;r!=d[o];r++)if(d[o][r].id=t){e=r;break}-1!=e&&(d[o].splice(e,1),n=[],i.forEach(function(e){try{e(o)}catch(t){n.push(e)}}),n.forEach(function(t){w.onMediaRemove.removeListener(t)}))}},this.onMediaRemove={addListener:function(t){i.push(t)},removeListener:function(t){t=i.indexOf(t);-1!=t&&i.splice(t,1)}}}}.apply(fbdExtensionApp.Media),function(){this.Sniffer=new function(){const e=["flv","ram","mpg","mpeg","avi","rm","wmv","mov","asf","rbs","movie","divx","mp4","ogg","mpeg4","m4v","webm"],o=["mp3"],n=["swf"],r=/^(video)/i,i=["jpg","jpeg","gif","png","bmp","tiff","js","css","woff","woff2","ttf"];const a={mpeg:"mp4",m4v:"mp4","3gpp":"3gp",flv:"flv","x-flv":"flv",quicktime:"mov",msvideo:"avi","ms-wmv":"wmv","ms-asf":"asf",web:"webm"},s={realaudio:"ra","pn-realaudio":"rm",midi:"mid",mpeg:"mp3",mpeg3:"mp3",wav:"wav",aiff:"aif"},c=["://s.ytimg.com","://o-o.preferred.","youtube.com","soloset.net","solosing.com","static.doubleclick.net"],h={m4v:"mp4"},l=["ustream.tv/([^.]*)","twitch.tv/([^.]*)","periscope.tv/([^.]*)","break.com/video/([^.]*)","http://(www.)?dailymotion(.co)?.([^./]+)/","www.facebook.com/(.*)","metacafe.com/watch/(.*)","vk.com","hulu.com","cnn.com","cbsnews.com","www.vevo.com","www.pandora.com","www.music.yahoo.com","www.spotify.com","www.tunein.com","www.last.fm","www.iheart.com","www.allmusic.com","www.radio.com","soundcloud.com"];var p=this,u=[];function w(t){return-1==e.indexOf(t)&&-1==o.indexOf(t)&&n.indexOf(t),1}function d(t){if(t){var e=t.split("/");if(2==e.length)switch(e[0]){case"audio":if(s[e[1]])return s[e[1]];break;case"video":if(a[e[1]])return a[e[1]]}}return null}function m(t,e){t=t.toLowerCase();for(var o=0;o!=e.responseHeaders.length;o++)if(e.responseHeaders[o].name.toLowerCase()==t)return e.responseHeaders[o].value;return null}function f(t){try{var e=m("Content-Disposition",t),o=e.match(/^(inline|attachment);/i);if(null!=o&&"attachment"==o[1].toLowerCase()){";"!=(e=e.substr(o[0].length)).charAt(e.length-1)&&(e+=";");var n=e.match(/filename="(.*?)"\s*?(?:;|$)/i);if(null!=(n=null==n?e.match(/filename=(.*?)\s*?(?:;|$)/i):n))return n[1]}}catch(t){}return null}this.prepareMedia=function(t){var e,o,n,r,i,a,s=null;return-1!=t.url.indexOf("#")&&(t.url=t.url.substring(0,t.url.indexOf("#"))),-1!=t.url.indexOf("tumblr.com")&&-1!=t.url.indexOf("#_=_")&&(t.url=t.url.replace("#_=_","")),-1!=t.url.toLowerCase().indexOf("dailymotion.com/video/")||-1!=t.url.toLowerCase().indexOf("youtube.com")||-1!=t.url.toLowerCase().indexOf("break.com")||-1!=t.url.toLowerCase().indexOf("edgecastcdn.net")||/^https?:\/\/(.*)seg(\d+)-frag(\d+)/.test(t.url.toLowerCase())||/\/segment\-[0-9]\.m4s/.test(t.url.toLowerCase())||/^https?:\/\/(.*)\.ts/.test(t.url.toLowerCase())?null:((e=f(t))&&(s=fbdExtensionApp.Utils.extractExtension(e)),e=null,(o=fbdExtensionApp.Utils.extractPath(t.url))?(s=s||o.ext,e=o.name):(e=p.getFileName(t),s=d(m("content-type",t))),s=(s=s||fbdExtensionApp.Utils.extractExtension(t.url)).toLowerCase(),h[s]&&(s=h[s]),o=m("Content-Length",t),r=n=t.tab.title||p.getFileName(t),i=0,i=(new Date).getTime(),(a=e||t.url)&&10<a.length&&a.substr(0,10),{url:t.url,tabId:t.tabId,frameId:t.frameId,ext:s,title:a,format:"",downloadName:n||"media",displayName:r,filename:e||t.url,priority:10,vubor:0,size:o,type:"video",metod:"download",source:"Sniffer",groupId:0,dwnl:1,orderField:i})},this.getFileName=function(t){var e=f(t);if(e)return e;e=t.url.split("?");if(-1!=(e=(e=e[0].split("/"))[e.length-1]).indexOf(".")){t=d(m("content-type",t));t&&((e=e.split(".")).pop(),e.push(t),e=e.join("."));try{return decodeURIComponent(e)}catch(t){return window.unescape?unescape(e):e}}return null},this.isMedia=function(t){if(!t.tabId)return!1;var e=m("content-type",t);if(e){e.split("/");if(r.test(e))return!0}var o,n,e=m("content-length",t);return!(!e||(o=102400,"video_100kb"==(n=fbdExtensionApp.Prefs.get("fbd.trigger_video_more"))?o=102400:"video_1mb"==n&&(o=1048576),e<o)||(n=fbdExtensionApp.Utils.extractExtension(t.url))&&-1!=i.indexOf(n)||(w(n),0))},this.checkCombine=function(t,e){var o=fbdExtensionApp.Media.Storage.getDataForSource(t.tab.id,"Combine"),n=t.url,r=t.tab.id;if(o&&1==o.length)return c(n,(s=o[0].playlist)[0])&&(s.push(n),fbdExtensionApp.Media.Storage.setPlaylist(r,o[0].id,s)),!0;if((o=fbdExtensionApp.Media.Storage.getDataForSource(r,"Sniffer"))&&3<o.length){for(var i=[],a=0;a<o.length;a++)c(n,o[a].url)||i.push(o[a].id);if(100*i.length/o.length<20){(o=fbdExtensionApp.Media.Storage.removeTabSourceData(r,"Sniffer",i)).sort(function(t,e){return t.id>e.id?1:-1});for(var s=[],a=0;a<o.length;a++)s.push(o[a].url);return s.push(n),e({url:o[0].url,playlist:s,tabId:r,frameId:t.frameId,ext:"mp4",title:o[0].title,format:"",downloadName:o[0].downloadName,displayName:o[0].displayName,filename:o[0].fileName,priority:11,vubor:0,type:"video",metod:"stream",source:"Combine",groupId:0,dwnl:1}),!0}}function c(t,e){var o=0;if(u1=fbdExtensionApp.Utils.parse_URL(t),u2=fbdExtensionApp.Utils.parse_URL(e),u1.hostname==u2.hostname){for(var n in s1=h(u1.search.substring(1,u1.search.length)),s2=h(u2.search.substring(1,u2.search.length)),s1)s1[n]!=s2[n]&&o++;return 1<o?void 0:1}}function h(t){for(var e={},o=t.split("&"),n=0;n<o.length;n++){var r=o[n].split("=");e[r[0]]=r[1]}return e}return!1},this.onMediaDetect={addListener:function(t){-1==u.indexOf(t)&&u.push(t)},removeListener:function(){u.length=0}},this.isEqualItems=function(t,e){return t.url==e.url},chrome.webRequest.onResponseStarted.addListener(function(i){if(!i||i.tabId<0)return!1;chrome.tabs.get(i.tabId,function(t){if(!chrome.runtime.lastError)if(t){var e,o=t;for(e in l)try{if(new RegExp(l[e],"i").test(o.url.toLowerCase()))return null}catch(t){}if(p.isMedia(i)){if(fbdExtensionApp.noYoutube)for(var n=0;n!=c.length;n++){var r=c[n];if(-1!=i.url.indexOf(r))return}i.tab=o,u.forEach(function(t){p.checkCombine(i,t)||t(p.prepareMedia(i))})}}else console.log(i)})},{urls:["<all_urls>"]},["responseHeaders"])};this.Combine=new function(){this.isEqualItems=function(t,e){return t.url==e.url}}}.apply(fbdExtensionApp.Media),function(){this.DailyMotion=new function(){var n=[];function s(t,e,o){var n=!1,r=[],t=/\"metadata\"\:(.*)\}\)/.exec(t);if(t){var i,a=JSON.parse(t[1]),s=a.title,c=(s&&(baseFileName=s),a=a.qualities,{144:{label:"LOW"},240:{label:"LD"},380:{label:"SD"},480:{label:"HQ"},720:{label:"HD"},1080:{label:"FULL HD"}});for(i in c){var h,l,p,u,w,d,m=a[i];if(m)for(var f in m)m[f]&&(d=w=u=p=l=h=void 0,h=s,l=m[f].url,p=c[i].label,u="flv",w=p,(d=fbdExtensionApp.Utils.extractPath(l))&&(u=d.ext,w=p+"_"+d.name),d={url:l,title:h,format:p,quality:p,downloadName:"["+p+"] "+baseFileName,displayName:"["+p+"] "+baseFileName,filename:w,ext:u,type:"video",size:null,dwnl:1},r.push(d),n=!0)}n&&o(r)}}function c(t,e){var t="http://www.dailymotion.com/embed/video/"+t,o=new XMLHttpRequest;o.open("GET",t,!0),o.setRequestHeader("Cache-Control","no-cache"),o.onload=function(){e(this.responseText)},o.onerror=function(){e(null)},o.send(null)}function h(e,o){e.forEach(function(t){t.tabId=o.tabId,t.frameId=o.frameId,t.priority=20,t.metod="download",t.source="DailyMotion"}),n.forEach(function(t){t(e)}),fbdExtensionApp.ContentScriptController.processMessage(o.tabId,{action:"insertDMButton",media:e})}this.onMediaDetect={addListener:function(t){-1==n.indexOf(t)&&n.push(t)}},this.isEqualItems=function(t,e){if(t.type==e.type&&t.displayName==e.displayName)try{if(t.url.split("?")[0]==e.url.split("?")[0])return!0}catch(t){}return!1},chrome.webRequest.onResponseStarted.addListener(function(a){if(!a||a.tabId<0)return!1;chrome.tabs.get(a.tabId,function(t){if(!chrome.runtime.lastError)if(t){if(!(a.tab=t).url)return!1;/(www\.)?dailymotion\.com?\/cdn\/manifest\/video\//i.test(a.url)?(i=function(t){t&&h(t,a)},(r=a)&&"url"in r?(t=r.url.match(/dailymotion\.com\/cdn\/manifest\/video\/(.+?)\.m3u8/i),(videoId=t?t[1]:videoId)&&c(videoId,function(t){s(t,0,i)})):i(null)):/(www\.)?dailymotion\.com?\/embed\/video\//i.test(a.url)&&(o=function(t){t&&h(t,a)},(e=a)&&"url"in e?(n=(t=-1!=(n=(t=e.url).indexOf("?"))?t.substring(0,n):t).match(/\.dailymotion\.com\/embed\/video\/(.+?)$/i),(videoId=n?n[1]:videoId)&&c(videoId,function(t){s(t,0,o)})):o(null))}else console.log(a);var e,o,n,r,i})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){this.VKontakte=new function(){var n=[];const c=["^https?:\\/\\/(.+?)\\.vk-cdn\\.net\\/(.+?)\\.mp3?","^https?:\\/\\/(.+?)\\.vk\\.me\\/(.+?)\\.mp3?"];function o(t,e,o){var n,r=new XMLHttpRequest,i=(r.open("POST",t,!0),r.setRequestHeader("Cache-Control","no-cache"),r.setRequestHeader("X-FBD-Extra","yes"),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.onload=function(){var t=this.responseText;o(t)},r.onerror=function(){o(null)},[]);for(n in e)i.push(n+"="+e[n]);r.send(i.join("&"))}function h(t){return{videoId:t.videoId,url:t.url,tabId:t.tabId,frameId:t.frameId,ext:t.ext,title:t.title,format:"",downloadName:t.title,displayName:t.title,filename:t.filename,priority:10,vubor:0,size:0,type:"video",metod:"download",source:"VKontakte",groupId:0,dwnl:1}}function l(e,o){e&&(e.length?e.forEach(function(t){t.tabId=o.tabId,t.priority=1,t.dwnl=1,t.metod="download",t.source="VKontakte"}):(e.tabId=o.tabId,e.priority=1,e.dwnl=1,e.metod="download",e.source="VKontakte"),n.forEach(function(t){t(e)}))}this.onMediaDetect={addListener:function(t){-1==n.indexOf(t)&&n.push(t)}},this.isEqualItems=function(t,e){return t.url==e.url},chrome.extension.onRequest.addListener(function(t,e,o){"set_VK_Audio_Media_title"==t.akce&&(tabId=t.tabId,url=t.url,ext=t.ext,title=t.title,fbdExtensionApp.Media.Storage.setData_AttributeUrl(tabId,url,"title",title),10<(frmt=title).length&&(frmt=frmt.substr(0,10)+"..."),fbdExtensionApp.Media.Storage.setData_AttributeUrl(tabId,url,"format",frmt),downloadName=title+"."+ext,fbdExtensionApp.Media.Storage.setData_AttributeUrl(tabId,url,"downloadName",downloadName))}),chrome.webRequest.onBeforeRequest.addListener(function(e){if("POST"==e.method){if(!e||e.tabId<0)return!1;chrome.tabs.get(e.tabId,function(t){if(!chrome.runtime.lastError)if(t){if(!(e.tab=t).url)return!1;/^https?:\/\/vk\.com\/al_video\.php/i.test(e.url)&&(s=!(a=function(t){t&&l(t,e)}),c=[],"video"in(t=(i=e).requestBody.formData))&&o(i.url,t,function(t){var e,o,n,t=t.match(/<!json>{(.+?)}<!>/i);t&&(t=JSON.parse("{"+t[1]+"}"),console.log(t),e=(n=t.mvData).videoRaw,o=n.title.replace(/&(.+?);/gm,"").trim(),(n=t.player.params[0]).url240&&r(n.url240,e,"[240] "+o),n.url360&&r(n.url360,e,"[360] "+o),n.url480&&r(n.url480,e,"[480] "+o),n.url720&&r(n.url720,e,"[720] "+o),n.url1080)&&r(n.url1080,e,"[1080] "+o),s&&setTimeout(function(){a(c)},1500)})}else console.log(e);function r(t,e,o){var n=fbdExtensionApp.Utils.extractPath(t);n&&(e=h({videoId:e,url:t,filename:n.name,ext:n.ext,title:o,tabId:i.tabId,frameId:i.frameId}),c.push(e),s=!0)}var i,a,s,c})}},{urls:["https://vk.com/*"]},["requestBody"]),chrome.webRequest.onResponseStarted.addListener(function(s){if(!s||s.tabId<0)return!1;chrome.tabs.get(s.tabId,function(t){if(!chrome.runtime.lastError)if(t){if(!(s.tab=t).url)return!1;var e,o,n,r,i=s,t=function(t){t&&l(t,s)},a=!1;for(e in c)try{if(new RegExp(c[e],"i").test(i.url.toLowerCase())){a=!0;break}}catch(t){}a&&(o=i.url,r=(n=fbdExtensionApp.Utils.extractPath(o)).name,n)&&t([{videoId:r,url:o,tabId:i.tabId,frameId:i.frameId,ext:"mp3",title:i.tab.title,format:"",downloadName:i.tab.title,displayName:i.tab.title,filename:r,priority:10,vubor:0,size:0,type:"video",metod:"download",source:"VKontakte",groupId:0,dwnl:1}])}else console.log(s)})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){var r=null;function i(t,e){t&&(e&&({url:t}.filename=p.modify(e)),chrome.tabs.create({url:"https://fdown.net/downloader.php?id="+btoa(t).split("").reverse().join("")}))}function a(t,e,o,n){t="https://www.facebook.com/video/video_data_async/?video_id="+t+"&fb_dtsg_ag="+e+"&__user_id="+this.user_id+"&__a=1",e=new Request(t,{method:"GET",redirect:"follow",credentials:"include"});fetch(e).then(t=>t.text()).then(t=>{n(h(t))}).catch(()=>{n({error:!0})})}function s(t,e,o){t="https://www.facebook.com/video/embed/async/dialog/?url="+encodeURIComponent(t)+"&dpr=1&__a=0",t=new Request(t,{method:"GET",redirect:"follow",credentials:"include"});fetch(t).then(t=>t.text()).then(t=>{t=h(t);t.url?o(t):e?a(e,o):o({error:!0})}).catch(()=>{e?a(e,o):o({error:!0})})}function c(t,e){t=new Request(t,{method:"GET",redirect:"follow",credentials:"include"});fetch(t).then(t=>t.text()).then(t=>{e(h(t))}).catch(()=>{e({error:!0})})}function h(t){var e=/"sd_src":"(.*?)"/.exec(t),o=/"hd_src":"(.*?)"/.exec(t),e=e&&e.length?e[1].replace(/\\/g,"").replace(/u0025/g,"%"):"",o=o&&o.length?o[1].replace(/\\/g,"").replace(/u0025/g,"%"):"",t=p.getFromHtml(t,o||e);return o?{url:o,filename:t}:e?{url:e,filename:t}:{error:!0}}function l(t){var e=chrome.extension.getURL("assets/images/icon_download_enabled.png");chrome.browserAction.setIcon({path:e,tabId:t})}var p={getFromHtml:function(t,e){try{var o,n;return-1==e.indexOf(".mp4")?null:(n=(o=/<title.+<\/title>/.exec(t))&&o[0]?$(o[0]).text():null)&&n.length?(n=n.substr(0,100),this.modify(n)+".mp4"):null}catch(t){return null}},getFileNameFromUrl:function(t){return"string"!=typeof t?null:(t=(t=t.match(/\/([^\/?]+)(?:$|\?)/))&&t[1],this.modify(t))},rtrim:/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,illegalRe:/[\/\?<>\\:\*\|"~]/g,controlRe:/[\x00-\x1f\x80-\x9f]/g,reservedRe:/^\.+/,partsRe:/^(.+)\.([a-z0-9]{1,4})$/i,specialChars:"nbsp,iexcl,cent,pound,curren,yen,brvbar,sect,uml,copy,ordf,laquo,not,shy,reg,macr,deg,plusmn,sup2,sup3,acute,micro,para,middot,cedil,sup1,ordm,raquo,frac14,frac12,frac34,iquest,Agrave,Aacute,Acirc,Atilde,Auml,Aring,AElig,Ccedil,Egrave,Eacute,Ecirc,Euml,Igrave,Iacute,Icirc,Iuml,ETH,Ntilde,Ograve,Oacute,Ocirc,Otilde,Ouml,times,Oslash,Ugrave,Uacute,Ucirc,Uuml,Yacute,THORN,szlig,agrave,aacute,acirc,atilde,auml,aring,aelig,ccedil,egrave,eacute,ecirc,euml,igrave,iacute,icirc,iuml,eth,ntilde,ograve,oacute,ocirc,otilde,ouml,divide,oslash,ugrave,uacute,ucirc,uuml,yacute,thorn,yuml".split(","),specialCharsList:[["amp","quot","lt","gt"],[38,34,60,62]],specialCharsRe:/&([^;]{2,6});/g,rnRe:/\r?\n/g,re1:/[\*\?"]/g,re2:/</g,re3:/>/g,spaceRe:/[\s\t\uFEFF\xA0]+/g,dblRe:/(\.|!|\?|_|,|\-|:|\+){2,}/g,re4:/[\.,:;\/\-_\+=']$/g,decodeUnicodeEscapeSequence:function(e){try{return JSON.parse(JSON.stringify(e).replace(/\\(\\u[0-9a-f]{4})/g,"$1"))}catch(t){return e}},decodeSpecialChars:function(t){var r=this;return t.replace(this.specialCharsRe,function(t,e){var o,n=null;return"#"===e[0]?(n=parseInt(e.substr(1)),isNaN(n)?"":String.fromCharCode(n)):-1!==(o=r.specialCharsList[0].indexOf(e))?(n=r.specialCharsList[1][o],String.fromCharCode(n)):-1!==(o=r.specialChars.indexOf(e))?(n=o+160,String.fromCharCode(n)):""})},trim:function(t){return t.replace(this.rtrim,"")},getParts:function(t){return t.match(this.partsRe)},modify:function(e){if(!e)return"";e=this.decodeUnicodeEscapeSequence(e);try{e=decodeURIComponent(e)}catch(t){e=unescape(e)}var t;return e=(e=this.decodeSpecialChars(e)).replace(this.rnRe," "),!((e=(e=this.trim(e)).replace(this.re1,"").replace(this.re2,"(").replace(this.re3,")").replace(this.spaceRe," ").replace(this.dblRe,"$1").replace(this.illegalRe,"_").replace(this.controlRe,"").replace(this.reservedRe,"").replace(this.re4,"")).length<=this.maxLength)&&(t=this.getParts(e))&&3==t.length?(t[1]=t[1].substr(0,this.maxLength),t[1]+"."+t[2]):e}};var u={connected_port:null,messageTimeout:0,messageDelay:1e3,connect:function(t){var o=this;(o.connected_port=t).onDisconnect.addListener(function(){o.connected_port=null}),t.onMessage.addListener(function(t,e){if(e!==o.connected_port)return o.connect(e);t&&"clear"==t.action?chrome.tabs.query({active:!0,currentWindow:!0},function(t){t[0]&&(w.clear(t[0].id),l(t[0].id))}):t&&"user_popup_rate"==t.action?chrome.storage.sync.set({user_popup_rate:t.value}):t&&"user_report"==t.action?trackEvent("user_report",JSON.stringify(t.data)):t&&"scroll"==t.action?t.data.is_embed?(e="var element = document.querySelector('iframe[src="+t.data.scroll_url+"]');element && element.scrollIntoView({block: 'center', behavior: 'smooth'});",chrome.tabs.executeScript(t.tab_id,{code:e},function(t){})):w.scroll(t.tab_id,t.data.scroll_data_el):t&&"go_to_by_shortcut"==t.action&&d.changeOpts(t.val)})},newVideoFound:function(t){null!==this.connected_port&&this.connected_port.postMessage({action:"video_added",data:t})},updateVideo:function(t){null!==this.connected_port&&this.connected_port.postMessage({action:"video_updated",data:t})},storeMedia:function(t,e){fbdExtensionApp.Media.Storage.addItemForTab(e,{videoId:t.video_id,hash:t.title,downloadName:t.title,displayName:t.title,thumb:t.thumb,type:"video",metod:"download",source:"FaceBook",url:t.url,status:"stop",item:0,format:"",quality:"",title:"",filename:"",ext:"",size:null,groupId:0,orderField:0})}},w={activeList:{},connect:function(t){var o=this,n=this.activeList,r=t.sender.tab.id;n[r]=this.activeList[r]||{},(n[r][t.name]=t).onDisconnect.addListener(function(t){delete n[r][t.name],0==Object.keys(n[r]).length&&delete n[r]}),t.onMessage.addListener(function(t,e){"video_found"==t.action?(n[r][e.name].is_embed=t.found_video.is_embed,o.addVideo({tab_id:r,port_name:e.name,found_video:t.found_video},function(){l(r,o.getVideos(r).length),u.newVideoFound(t.found_video)}),u.storeMedia(t.found_video,r),chrome.extension.sendMessage({subject:"mediaForTabUpdate",data:r}),d.enabled&&(n[r][e.name].is_embed?d.injectShortcatsScript(r):e.postMessage("shortcuts_enabled"))):"update_video"==t.action&&o.updateVideo({tab_id:r,port_name:e.name,found_video:t.found_video},function(t){})})},addVideo:function(t,e){var o=t.tab_id,n=t.port_name,t=t.found_video,r=this.activeList,i=t.video_id;i&&(r[o][n]||(r[o][n]={}),r[o][n].videos||(r[o][n].videos={}),r[o][n].videos[i]||(r[o][n].videos[i]=t,e()))},updateVideo:function(t,e){var o,n,r=t.tab_id,i=t.port_name,t=t.found_video,a=this.activeList;a[r][i].videos&&(o=t.video_id)&&((n=a[r][i].videos[o])&&("object"==typeof n&&n.thumb?n.thumb=n.thumb:"object"==typeof t&&t.thumb?n.thumb=t.thumb:n.thumb=null),e(a[r][i].videos[o]=n))},getVideos:function(t){var e=[],o=this.activeList;if(o[t]&&0<Object.keys(o[t]).length)for(var n in o[t])if(o[t].hasOwnProperty(n)&&o[t][n].hasOwnProperty("videos"))for(var r in o[t][n].videos)o[t][n].videos.hasOwnProperty(r)&&e.push(o[t][n].videos[r]);return e},isConnectedTab:function(t){return this.activeList[t]&&0<Object.keys(this.activeList[t]).length},clear:function(t){var e,o=this.activeList;for(e in o[t])o[t].hasOwnProperty(e)&&(o[t][e].videos={})},scroll:function(t,e){var o,n=this.activeList;for(o in n[t])n[t].hasOwnProperty(o)&&n[t][o].postMessage({action:"scroll",scroll_data_el:e})},enableShortcuts:function(){var t,e=this.activeList,o=[];for(t in e)if(e.hasOwnProperty(t))for(var n in e[t])e[t].hasOwnProperty(n)&&(e[t][n].is_embed?-1==o.indexOf(parseInt(t))&&o.push(parseInt(t)):e[t][n].postMessage("shortcuts_enabled"));o.forEach(d.injectShortcatsScript)},disableShortcuts:function(){var t,e=this.activeList,o=[];for(t in e)if(e.hasOwnProperty(t))for(var n in e[t])e[t].hasOwnProperty(n)&&(e[t][n].is_embed?-1==o.indexOf(parseInt(t))&&o.push(parseInt(t)):e[t][n].postMessage("shortcuts_disabled"));o.forEach(function(t){chrome.tabs.sendMessage(t,"shortcuts_disabled")})}},d={enabled:!0,setInitVal:function(){var e=this;chrome.storage.sync.get("settings",function(t){t=t.settings||{};void 0===t.go_to_by_shortcut&&(t.go_to_by_shortcut=!0),e.enabled=t.go_to_by_shortcut,chrome.storage.sync.set({settings:t})})},changeOpts:function(t){(this.enabled=t)?w.enableShortcuts():w.disableShortcuts()},injectShortcatsScript:function(e){chrome.tabs.executeScript(e,{runAt:"document_idle",code:'window["fb_dl_shortcut_scroll_6295"];'},function(t){t&&t[0]?chrome.tabs.sendMessage(e,"shortcuts_enabled"):(chrome.tabs.executeScript(e,{runAt:"document_idle",code:'window["fb_dl_shortcut_scroll_6295"] = 1;'}),chrome.tabs.executeScript(e,{runAt:"document_idle",file:"/js/shortcut.js"}))})}};void 0===window.localStorage.installedTime&&(window.localStorage.installedTime=Date.now());chrome.runtime.onMessage.addListener(function(t,e,o){if(t&&"request"==t.action&&(t.video_id||t.permalink||t.full_url))return function(n,r){if(n.permalink)var t=n.permalink;else if(n.video_id){if(/https?:\/\/.*\.mp4/.test(n.video_id))return r({url:n.video_id});t="https://www.facebook.com/video.php?v="+n.video_id}else if(n.full_url)return n.is_embed?c(n.full_url,r):s(n.full_url,null,function(t){if(!t.error)return r(t);c(n.full_url,r)});t=new Request(t,{method:"GET",redirect:"follow",credentials:"omit"});fetch(t).then(t=>t.text()).then(t=>{for(var e,o=/(hd|sd)\_src\:\"(\w[^"]*)\"/gim;null!==(m=o.exec(t));)if(m[2])return e=p.getFromHtml(t,m[2]),r({url:m[2],filename:e}),!0;return n.full_url?s(n.full_url,n.video_id,r):n.video_id?a(n.video_id,n.async_get_token,n.user_id,r):void r({error:!0})}).catch(()=>{r({error:!0})})}(t,o),!0;if(t&&"download"==t.action&&t.url)i(t.url,t.filename);else{if("getVideosCurrentTab"==t)return n=o,chrome.tabs.query({active:!0,currentWindow:!0},function(t){var e=t&&t.length&&t[0].id;if(e){var o={videos:[],isFacebook:!1,isPageConnected:!1,count:0,tabStatus:t[0].status,tabId:e,isNotAuthorizedInFB:!1};if(!e||!/^https?:\/\//.test(t[0].url))return n(o);o.isFacebook=-1<t[0].url.indexOf("facebook.com"),w.isConnectedTab(e)?(o.isPageConnected=!0,o.videos=w.getVideos(e),o.count=o.videos.length,0===o.count&&o.isFacebook?chrome.cookies.getAll({domain:"facebook.com",name:"c_user"},function(t){t.length||(o.isNotAuthorizedInFB=!0),n(o)}):n(o)):(o.isFacebook&&chrome.cookies.getAll({domain:"facebook.com",name:"c_user"},function(t){return t.length||(o.isNotAuthorizedInFB=!0),n(o)}),chrome.tabs.executeScript(t[0].id,{code:'var frames = document.querySelectorAll(\'iframe[src*="facebook.com"][src*="/video"]\'); frames.length'},function(t){o.count=t&&t[0]||0,n(o)}))}}),!0;if("getInterceptedVideo"==t){if(null!==r)return i(r),!0}else t&&t.action}var n}),chrome.webRequest.onResponseStarted.addListener(function(e){if(!e||e.tabId<0)return!1;chrome.tabs.get(e.tabId,function(t){chrome.runtime.lastError||t&&(e.tab=t,/^https?:\/\/www\.facebook\.com\/(.*)/i.test(e.tab.url.toLowerCase()))&&/\.mp4/i.test(e.tab.url.toLowerCase())&&(r=e.tab.url)})},{urls:["http://*/*","https://*/*"],types:["main_frame","sub_frame","object","xmlhttprequest"]},["responseHeaders"]),chrome.tabs.onUpdated.addListener(function(t,e,o){e.url&&e.url.indexOf("facebook.com")}),chrome.runtime.onConnect.addListener(function(t){t.sender.id===chrome.runtime.id&&("popup"===t.name?u.connect(t):t.sender.tab&&w.connect(t))})}(),function(){this.BreakCom=new function(){var r=[];function e(a,s){tabInfo=a.tab;var c,t,e,o;a.url.lastIndexOf("-");/Seg[0-9]-Frag[0-9]/i.test(a.url.toLowerCase())&&-1!=(o=(t=tabInfo.url).lastIndexOf("-"))&&(c=t.substr(o+1),e=function(t){var e=t.match(/"AuthToken"\s*:\s*"(.+?)"/i),o=t.match(/"videoUri"\s*:\s*"(.+?)"/i),n=t.match(/"contentName"\s*:\s*"(.+?)"/i),t=(t.match(/"pageUri"\s*:\s*"(.+?)"/i),o[1]+"?"+e[1]),e=n[1],n=null,r="mp4",i=fbdExtensionApp.Utils.extractPath(o[1]),n=i?(r=i.ext,i.name):(r=fbdExtensionApp.Utils.extractExtension(o[1]),name),i=(e&&10<e.length&&e.substr(0,10),{url:t,tabId:a.tabId,frameId:a.frameId,ext:r,title:e,format:"",videoId:c,displayName:e,downloadName:e,filename:n||"no name",priority:20,vubor:0,size:null,type:"video",groupId:0,dwnl:1,orderField:0});s(i)},t="http://www.break.com/embed/"+(t=c)+"/",(o=new XMLHttpRequest).open("GET",t,!0),o.setRequestHeader("Cache-Control","no-cache"),o.onload=function(){var t=this.responseText;e(t)},o.onerror=function(){e(null)},o.send(null))}this.onMediaDetect={addListener:function(t){-1==r.indexOf(t)&&r.push(t)}},this.isEqualItems=function(t,e){return t.videoId==e.videoId},chrome.webRequest.onResponseStarted.addListener(function(n){if(!n||n.tabId<0)return!1;chrome.tabs.get(n.tabId,function(t){chrome.runtime.lastError||(t?(n.tab=t=t,/break.com\/video\/([^.]*)/i.test(t.url.toLowerCase())&&e(n,function(t){var e,o;t&&(o=n,e=t)&&(e.length?e.forEach(function(t){t.tabId=o.tabId,t.priority=1,t.metod="download",t.source="BreakCom"}):(e.tabId=o.tabId,e.priority=1,e.metod="download",e.source="BreakCom"),r.forEach(function(t){t(e)}))})):console.log(n))})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){this.Twitch=new function(){var n=[];const s=[{url:"twitch.tv",player:"/player.",channel:"\\/api\\/channel(.+?)\\.m3u8\\?",icons:"twitch.png",type:"twitch"},{url:"twitch.tv",player:"/player.",channel:"\\/vod\\/(.*).m3u8",icons:"twitch.png",type:"twitch"},{url:"periscope.tv",player:"/player.",channel:"https?:\\/\\/periscope\\-(.*)\\/playlist.m3u8\\?",icons:"periscope.png",type:"periscope"}],c=[{url:"periscope.tv",player:"/player.",channel:"https://replay.periscope.tv/(.*)/playlist.m3u8",icons:"periscope.png",type:"periscope"}];function h(t,l){tabInfo=t.tab,console.log("TWITCHTEST FOUND STREAM: ",t);var e=t.url,o=null;try{var n=t.tab.url;-1!=(r=n.indexOf("?"))&&(n=n.substring(0,r)),o=/([^\/]+)$/.exec(n)[1]}catch(t){}o||-1!=(r=e.indexOf(".m3u8"))&&(n=e.substring(0,r),o=/([^\/]+)$/.exec(n)[1]),console.log("videoId = ",o);var p,u,w=[],d=t.tab.title,r=(p=o,u=e),i=function(t){for(var e,o,n,r,i,a,s=t.split("\n"),c=s.length,h=0;h<c;h++)""!=s[h]&&(-1!=s[h].indexOf("EXT-X-MEDIA:TYPE=VIDEO")?(e=/NAME="(.*)"/.exec(s[h])[1],o=s[h+2],e&&o&&(r=p+" ["+e+"]",i=p+"_"+e,console.log("hash = ",i),a=m(p,o,e,r,"mp4",i),w.push(a),0)):-1!=s[h].indexOf("EXT-X-STREAM-INF:BANDWIDTH")&&(e="stream",o=s[h+1],-1!=(n=u.indexOf("/playlist"))&&(o=u.substring(0,n)+"/"+o),a=m(p,o,e,r=d,"ts",i=p),w.push(a),0));l(w,p)},n=new XMLHttpRequest;n.open("GET",r,!0),n.setRequestHeader("Cache-Control","no-cache"),n.onload=function(){var t=this.responseText;i(t)},n.onerror=function(){i(null)},n.send(null)}function m(t,e,o,n,r,i){t={videoId:t,url:e,playlist:e,title:n,displayName:n,downloadName:n,format:o,quality:o,ext:r,status:"stop",hash:i,filename:i,size:0,type:"video",dwnl:1};return console.log(t),t}function l(e,o){e&&(e.length?e.forEach(function(t){t.tabId=o.tabId,t.priority=1,t.metod="record",t.source="Twitch",t.status="stop"}):(e.tabId=o.tabId,e.priority=1,e.metod="record",e.source="Twitch"),n.forEach(function(t){t(e)}))}this.onMediaDetect={addListener:function(t){-1==n.indexOf(t)&&n.push(t)}},this.isEqualItems=function(t,e){return t.hash==e.hash},chrome.webRequest.onResponseStarted.addListener(function(a){if(!a||a.tabId<0)return!1;chrome.tabs.get(a.tabId,function(t){if(!chrome.runtime.lastError)if(t){a.tab=t;t=function(t,e){for(var o in s)if(t.match(new RegExp(s[o].channel,"g"))&&e.match(new RegExp(s[o].url,"g")))return s[o];for(var o in c)if(t.match(new RegExp(c[o].channel,"g"))&&e.match(new RegExp(c[o].url,"g")))return c[o];return null}(a.url,t.url);if(t)if("twitch"==(a.opt=t).type)h(a,function(t,e){t&&(a.tab.videoId=e,l(t,a))});else if("periscope"==t.type){var t=function(t,e){t&&(a.tab.videoId=e,l(t,a))},e=(tabInfo=(i=a).tab,console.log("TWITCHTEST FOUND MEDIA: ",i),i.url),o=null;try{var n=i.tab.url;-1!=(r=n.indexOf("?"))&&(n=n.substring(0,r)),o=/([^\/]+)$/.exec(n)[1]}catch(t){}o||-1!=(r=e.indexOf(".m3u8"))&&(n=e.substring(0,r),o=/([^\/]+)$/.exec(n)[1]),console.log("videoId = ",o);var r=[],i=m(o,e,"media",i.tab.title,"ts",o);r.push(i),t(r,o)}}else console.log(a)})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){this.MediaStream=new function(){var i=[];const a=["twitch.tv","periscope.tv"],g={mp4a:"mp4",avc1:"mp4"};var v={};function y(t,e,o){var n=new XMLHttpRequest;if(n.open("GET",t,!0),n.setRequestHeader("Cache-Control","no-cache"),n.setRequestHeader("X-FBD-Extra","yes"),e)for(var r in e)n.setRequestHeader(r,e[r]);n.onload=function(){var t=this.responseText;o(t)},n.onerror=function(){o(null)},n.send(null)}function x(t,e,o){o.indexOf("dailymotion.com")}function e(s,c){var h,t,l,e,o,p,u,w,d,n,m,f,r=!1;if(a.forEach(function(t){return-1!=s.url.toLowerCase().indexOf(t)||-1!=s.tab.url.toLowerCase().indexOf(t)?!(r=!0):void 0}),!r)return/^https?:\/\/[^\?]*\.m3u8/.test(s.url.toLowerCase())?(p=s.url,u=hex_md5(p),w=null,d=s.tab.title,u in v&&1==v[u].load?void 0:void(u in v&&2==v[u].load?i(v[u].media,v[u].videoId):((n=p.match(/\/([A-Za-z0-9\_\-]+)\.m3u8/i))&&(w=n[1]),v[u]={load:1,videoId:w,videoTitle:d,segmFileName:[w],rootUrl:s.tab.url,media:null},setTimeout(function(){u in v&&1==v[u].load&&delete v[u]},3e3),m=!1,f=[],h=null,e="",-1!=(o=(l=p).lastIndexOf("/"))&&(l=l.substr(0,o+1)),h=l,-1!=(o=p.indexOf("//"))&&(e=l.substr(0,o-1),-1!=(o=(t=l.substring(o+2,l.length)).indexOf("/")))&&(h=e+"://"+(h=t.substr(0,o))),y(p,null,function(t){for(var e,o,n,r,i=t.split("\n"),a=0;a<i.length;a++)0==i[a].indexOf("#EXT-X-STREAM-INF:")&&(e=null,o="mp4",(r=(n=0!=(n=i[a+1]).indexOf("http")?0==n.indexOf("/")?h+n:l+n:n).match(/\/([A-Za-z0-9\_\-]+)\.m3u8/i))&&v[u].segmFileName.push(r[1]),(r=i[a].match(/\,\s?RESOLUTION=([^,]+)/i))&&(e=r[1]),(o=(r=i[a].match(/\,CODECS=\"([^.]+)\./i))?r[1]:o)in g&&(o=g[o]),r=S(w,w+"_"+(e||a),n,n,e,d,o,null),f.push(r),m=!0);m&&(fbdExtensionApp.Media.Storage.removeTabData(s.tab.id),v[u].load=2,v[u].videoId=w,v[u].videoTitle=d,v[u].media=f,c(f,w),x(0,0,s.tab.url,s.tab.id))})))):void(/\/video\/(.*)\/master\.json\?/.test(s.url.toLowerCase())&&(p=s.url,u=hex_md5(p),w=null,d=s.tab.title,u in v&&1==v[u].load||(u in v&&2==v[u].load?i(v[u].media,v[u].videoId):((n=p.match(/\/([A-Za-z0-9\_\-]+)\.m3u8/i))&&(w=n[1]),v[u]={load:1,videoId:w,videoTitle:d,segmFileName:[w],rootUrl:s.tab.url,media:null},setTimeout(function(){u in v&&1==v[u].load&&delete v[u]},3e3),m=!1,f=[],y(p,null,function(t){if(o=JSON.parse(t)){w=b(o,"clip_id"),baseUrl=b(o,"base_url"),baseUrl=function(t,e){if("/"==e)return t;var o=t.indexOf("?");-1!=o&&(t=t.substring(0,o));for(var n=t.split("/"),r=e.split("/"),i=0;i<r.length;i++)""==r[i]||".."==r[i]?n.length--:n.push(r[i]);return n.join("/")}(p,baseUrl),video=b(o,"video");for(var e=0;e<video.length;e++){var o=b(video[e],"init_segment"),n=window.atob(o),r=b(video[e],"base_url"),i=b(video[e],"width")+"x"+b(video[e],"height"),a=function(t,e){for(var o=[],n=0;n<t.length;n++)o.push(e+t[n].url);return o}(b(video[e],"segments"),baseUrl+"/"+r),r=S(w,w+"_"+i,baseUrl+"/"+r,a,i,d,"mp4",n);f.push(r),m=!0}m&&(v[u].load=2,v[u].videoId=w,v[u].videoTitle=d,v[u].media=f,c(f,w),x(0,0,s.tab.url,s.tab.id))}})))));function i(t,e){for(var o=!1,n=[],r=0;r<t.length;r++)n.push(t[r]),o=!0;o&&c(n,e)}function b(t,e){if("/"==e)return t;for(var o=e.split("/"),n=t,r=0;r<o.length;r++)n[o[r]]&&(n=n[o[r]]);return n}}function S(t,e,o,n,r,i,a,s){var c=fbdExtensionApp.Utils.extractPath(o);return{videoId:t,url:o,playlist:n,initSeg:s,title:i,format:r,quality:r,displayName:(r?"["+r+"] ":"")+i,downloadName:(r?"["+r+"] ":"")+i,ext:a,status:"stop",hash:e,filename:c?(r?r+"_":"")+c.name:(r?"["+r+"] ":"")+i,size:0,type:"video",metod:"stream",source:"MediaStream",dwnl:1}}this.addMediaStream=function(t){for(var e in mediaStream)if(mediaStream[e].hash==t.hash)return!1;return mediaStream.push(t),!0},this.clearMediaStream=function(t){var e,o=[];for(e in mediaStream)mediaStream[e].tabId!=t&&o.push(mediaStream[e]);return mediaStream=o,!0},this.isMediaStream=function(t,e){for(var o in mediaStream)if(mediaStream[o].hash==t&&mediaStream[o].tabId==e)return o;return-1},this.onMediaDetect={addListener:function(t){-1==i.indexOf(t)&&i.push(t)}},this.isEqualItems=function(t,e){return!(!t||!e||t.hash!=e.hash)},chrome.webRequest.onResponseStarted.addListener(function(r){if(!r||r.tabId<0)return!1;chrome.tabs.get(r.tabId,function(t){chrome.runtime.lastError||(t?(r.tab=t,e(r,function(t,e){var o,n;t&&(r.tab.streamId=e,n=r,o=t)&&(o.length?o.forEach(function(t){t.tabId=n.tabId,t.streamId=n.tab.streamId,t.priority=1}):(o.tabId=n.tabId,o.streamId=n.tab.streamId,o.priority=10),i.forEach(function(t){t(o)}))})):console.log(r))})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){this.MediaManifest=new function(){var i=[];const u=[];var k={},_=0;function e(e,m){var o=!1;if(u.forEach(function(t){return-1!=e.url.toLowerCase().indexOf(t)||-1!=e.tab.url.toLowerCase().indexOf(t)?!(o=!0):void 0}),!o){var f=!1,b=[];if(/^https?:\/\/[^\?]*\.f4m/.test(e.url.toLowerCase())){var g=e.url,v=hex_md5(g),y=null,x=e.tab.title;if(!(v in k&&1==k[v].load))if(v in k&&2==k[v].load){for(var t=k[v].media,n=k[v].videoId,r=!1,i=[],a=0;a<t.length;a++)i.push(t[a]),r=!0;r&&m(i,n)}else{k[y=v]={load:1,videoId:y,videoTitle:x,segmFileName:[y],rootUrl:e.tab.url,media:null},setTimeout(function(){v in k&&1==k[v].load&&delete k[v]},3e3);var S=g,n=S.lastIndexOf("/"),s=(-1!=n&&(S=S.substr(0,n+1)),-1!=(n=g.indexOf("//"))&&(S.substr(0,n-1),-1!=(n=(s=S.substring(n+2,S.length)).indexOf("/")))&&s.substr(0,n),g),c=null,h=function(t){t=fbdExtensionApp.Utils.parseXml(t);if(t){var e=S,o="",n=[],r="",i={};if(r=t.getElementsByTagName("duration")){try{o=r[0].textContent||r[0].duration.textContent}catch(t){return}r=t.getElementsByTagName("bootstrapInfo");for(var a=0;a<r.length;a++){var s=r[a].getAttribute("id"),c=r[a].textContent;i[s]=c}r=t.getElementsByTagName("media");for(a=0;a<r.length;a++){var h=r[a].getAttribute("bootstrapInfoId"),l=r[a].getAttribute("width"),p=r[a].getAttribute("height"),u=r[a].getAttribute("streamId"),w=r[a].getAttribute("bitrate"),d=r[a].getAttribute("url"),c=(/^https?/.test(d)||(d=e+d),r[a].textContent),h=i[h];h=h&&fbdExtensionApp.jspack.stringToBytes(window.atob(h)),n.push({streamId:u,width:l,height:p,bitrate:w,uri:d,metadata:window.atob(c),bootstrap:h,duration:o})}if(0!=n.length){for(a=0;a<n.length;a++)!function(t){var r=0,i=0,a=0,h={},e=t.height||t.bitrate;e||(u=g.match(/([0-9]*)x([0-9]*)/g))&&(e=u[u.length-1]);w(t.bootstrap),function(t){if(t&&0!=t.length){h.version=fbdExtensionApp.jspack.ReadByte(t,r),h.flags=fbdExtensionApp.jspack.ReadInt24(t,r+1),h.bootstrapVersion=fbdExtensionApp.jspack.ReadInt32(t,r+4);var e=fbdExtensionApp.jspack.ReadByte(t,r+8),o=(h.profile=(192&e)>>6,(32&e)>>5&&(h.live=!0,h.metadata=!1),h.update=(16&e)>>4,h.update||(h.segTable=[],h.fragTable=[]),h.timescale=fbdExtensionApp.jspack.ReadInt32(t,r+9),h.currentMediaTime=fbdExtensionApp.jspack.ReadInt64(t,r+13),h.smpteTimeCodeOffset=fbdExtensionApp.jspack.ReadInt64(t,r+21),r+=29,fbdExtensionApp.jspack.ReadString(t,r));h.movieIdentifier=o.str,r=o.pos,h.serverEntryCount=fbdExtensionApp.jspack.ReadByte(t,r++),h.serverEntryTable=[];for(var n=0;n<h.serverEntryCount;n++){o=fbdExtensionApp.jspack.ReadString(t,r);r=o.pos,h.serverEntryTable.push(o.str)}h.qualityEntryCount=fbdExtensionApp.jspack.ReadByte(t,r++),h.qualityEntryTable=[];for(n=0;n<h.qualityEntryCount;n++){o=fbdExtensionApp.jspack.ReadString(t,r);r=o.pos,h.qualityEntryTable.push(o.str)}o=fbdExtensionApp.jspack.ReadString(t,r);r=o.pos,h.drmData=o.str,r=(o=fbdExtensionApp.jspack.ReadString(t,r)).pos,h.metadata=o.str,h.segRunTableCount=fbdExtensionApp.jspack.ReadByte(t,r++),h.segTable=[];for(n=0;n<h.segRunTableCount;n++)w(t),"asrt"==i&&(h.segTable=function(t,e){if(t&&0!=t.length){for(var o=[],n=(fbdExtensionApp.jspack.ReadByte(t,e),fbdExtensionApp.jspack.ReadInt24(t,e+1),fbdExtensionApp.jspack.ReadByte(t,e+4)),r=(e+=5,[]),i=0;i<n;i++){var a=fbdExtensionApp.jspack.ReadString(t,e);e=a.pos,r.push(a.str)}var s=fbdExtensionApp.jspack.ReadInt32(t,e);e+=4;for(i=0;i<s;i++){var c=fbdExtensionApp.jspack.ReadInt32(t,e),h=fbdExtensionApp.jspack.ReadInt32(t,e+4);o.push({firstSegment:c,fragmentsPerSegment:h}),e+=8}return o}}(t,r)),r+=a;h.fragRunTableCount=fbdExtensionApp.jspack.ReadByte(t,r++),h.fragTable=[];for(n=0;n<h.fragRunTableCount;n++)w(t),"afrt"==i&&(h.fragTable=function(t,e){if(t&&0!=t.length){for(var o=[],n=(fbdExtensionApp.jspack.ReadByte(t,e),fbdExtensionApp.jspack.ReadInt24(t,e+1),fbdExtensionApp.jspack.ReadInt32(t,e+4),fbdExtensionApp.jspack.ReadByte(t,e+8)),r=(e+=9,[]),i=0;i<n;i++){var a=fbdExtensionApp.jspack.ReadString(t,e);e=a.pos,r.push(a.str)}var s=fbdExtensionApp.jspack.ReadInt32(t,e);e+=4;for(i=0;i<s;i++){var c=fbdExtensionApp.jspack.ReadInt32(t,e),h=fbdExtensionApp.jspack.ReadInt64(t,e+4),l=fbdExtensionApp.jspack.ReadInt32(t,e+12),p="";e+=16,0==l&&(p=fbdExtensionApp.jspack.ReadByte(t,e++)),o.push({firstFragment:c,firstFragmentTimestamp:parseInt(h),fragmentDuration:l,discontinuityIndicator:p})}return o}}(t,r)),r+=a;!function(){var t=h.segTable[0],e=h.segTable[h.segTable.length-1],o=h.fragTable[0],n=h.fragTable[h.fragTable.length-1];0==n.fragmentDuration&&0==n.discontinuityIndicator&&(h.live=!1,h.fragTable.pop(),n=h.fragTable[h.fragTable.length-1]);var r=!1,i=h.segTable[0];h.fragCount=i.fragmentsPerSegment;for(var a=1;a<h.segTable.length;a++)h.fragCount+=(h.segTable[a].firstSegment-h.segTable[a-1].firstSegment-1)*h.segTable[a-1].fragmentsPerSegment,h.fragCount+=h.segTable[a].fragmentsPerSegment;2147483648&h.fragCount||(h.fragCount+=o.firstFragment-1);2147483648&h.fragCount&&(r=!(h.fragCount=0));h.fragCount<n.firstFragment&&(h.fragCount=n.firstFragment);h.live?h.segStart=e.firstSegment:h.segStart=t.firstSegment;h.segStart<1&&(h.segStart=1);h.live&&!r?h.fragStart=h.fragCount-2:h.fragStart=o.firstFragment-1;h.fragStart<0&&(h.fragStart=0)}()}}(t.bootstrap);var o=[],n=h.segStart,s=h.fragStart;h.fragTable[0];for(;s<h.fragCount;){n=function(t){var e=h.segTable[0],o=h.segTable[h.segTable.length-1],n=h.fragTable[0];h.fragTable[h.fragTable.length-1];{if(1==h.segTable.length)return e.firstSegment;for(var r=e.firstSegment,i=n.firstFragment,a=e.firstSegment;a<=o.firstSegment;a++){s=h.segTable[a]||r;var s,c=i+s.fragmentsPerSegment;if(i<=t&&t<c)return a;r=s,i=c}}return o.firstSegment}(s+=1);o.push(t.uri+"Seg"+n+"-Frag"+s)}var c=function(t){if(t){var e=[70,76,86,1,5,0,0,0,9,0,0,0,0],o=e.length,n=t.length;metadata=[],fbdExtensionApp.jspack.WriteByte(metadata,0,18),fbdExtensionApp.jspack.WriteInt24(metadata,1,n),fbdExtensionApp.jspack.WriteInt24(metadata,4,0),fbdExtensionApp.jspack.WriteInt32(metadata,7,0);for(var r=0;r<n;r++)metadata.push(t[r]);fbdExtensionApp.jspack.WriteByte(metadata,11+n-1,9),fbdExtensionApp.jspack.WriteInt32(metadata,11+n,11+n);for(r=o-1;0<=r;r--)metadata.unshift(e[r]);return metadata.length=o+11+n+4,fbdExtensionApp.jspack.bytesToString(metadata)}return!1}(fbdExtensionApp.jspack.stringToBytes(t.metadata)),l="flv";{var p;t.streamId?-1!=(p=t.streamId.lastIndexOf("."))&&(p=t.streamId.substring(p+1,t.streamId.length),-1!=["mp4","flv","webm"].indexOf(p))&&(l=p):(_++,t.streamId="stream"+_)}var u=function(t){var e=t.label,o=fbdExtensionApp.Utils.extractPath(t.url);e=o?(t.label?t.label+"_":"")+o.name:(t.label?"["+t.label+"] ":"")+t.videoTitle;return{videoId:t.hash,url:t.url,playlist:t.urlList,initSeg:t.initSeg,title:t.videoTitle,format:t.label,quality:t.label,displayName:(t.label?"["+t.label+"] ":"")+t.videoTitle,downloadName:(t.label?"["+t.label+"] ":"")+t.videoTitle,ext:t.ext,status:"stop",hash:t.hash,filename:e,size:0,type:"video",metod:"stream",source:"MediaManifest",dwnl:1,params:t.options}}({hash:y+"_"+(e||""),url:g,urlList:o,label:e,videoTitle:x,ext:l,initSeg:c,options:{bootstrap:h}});function w(t){t&&0!=t.length&&(r=r||0,a=fbdExtensionApp.jspack.ReadInt32(t,r),i=fbdExtensionApp.jspack.bytesToString(t.slice(r+4,r+8)),1==a?(a=fbdExtensionApp.jspack.ReadInt64(t,r+8)-16,r+=16):(a-=8,r+=8),a<=0)&&(a=0)}b.push(u),f=!0}(n[a]);f&&(k[v].load=2,k[v].videoId=y,k[v].videoTitle=x,k[v].media=b,m(b,y))}}}},l=new XMLHttpRequest;if(l.open("GET",s,!0),l.setRequestHeader("Cache-Control","no-cache"),l.setRequestHeader("X-FBD-Extra","yes"),c)for(var p in c)l.setRequestHeader(p,c[p]);l.onload=function(){var t=this.responseText;h(t)},l.onerror=function(){h(null)},l.send(null)}}}}this.addLivePool=function(t){for(var e in LivePool)if(LivePool[e].hash==t.hash)return!1;return LivePool.push(t),!0},this.clearLivePool=function(t){var e,o=[];for(e in LivePool)LivePool[e].tabId!=t&&o.push(LivePool[e]);return LivePool=o,!0},this.isLivePool=function(t,e){for(var o in LivePool)if(LivePool[o].hash==t&&LivePool[o].tabId==e)return o;return-1},this.onMediaDetect={addListener:function(t){-1==i.indexOf(t)&&i.push(t)}},this.isEqualItems=function(t,e){return!(!t||!e||t.hash!=e.hash)},chrome.webRequest.onResponseStarted.addListener(function(r){if(!r||r.tabId<0)return!1;chrome.tabs.get(r.tabId,function(t){chrome.runtime.lastError||(t?(r.tab=t,e(r,function(t,e){var o,n;t&&(r.tab.streamId=e,n=r,o=t)&&(o.length?o.forEach(function(t){t.tabId=n.tabId,t.streamId=n.tab.streamId,t.priority=1}):(o.tabId=n.tabId,o.streamId=n.tab.streamId,o.priority=10),i.forEach(function(t){t(o)}))})):console.log(r))})},{urls:["<all_urls>"]},["responseHeaders"])}}.apply(fbdExtensionApp.Media),function(){this.SitePage=new function(){var e=[];this.getContentFromYoutubePage=function(t,e){getContentFromYoutubePage(t,e)},this.onMediaDetect={addListener:function(t){-1==e.indexOf(t)&&e.push(t)}},this.isEqualItems=function(t,e){return t.url==e.url}}}.apply(fbdExtensionApp.Media),window==chrome.extension.getBackgroundPage()?function(){this.MainButton=new function(){var s=this;const o=["//youtube.com","//www.youtube.com","//gaming.youtube.com","//soloset.net","//www.soloset.net","//solosing.com","//www.solosing.com"];const n=["//www.twitch.tv","//www.periscope.tv"],r=["//www.ustream.tv"];var i=0;function t(t){fbdExtensionApp.Utils.getActiveTab(t)}function c(t,e){var o=null;switch(i=t){case 0:o=chrome.extension.getURL("assets/images/icon_download_disabled.png");break;case 1:o=chrome.extension.getURL("assets/images/icon_download_enabled.png");break;case 2:o=chrome.extension.getURL("assets/images/icon_download_ongoing.png");break;case 3:o=chrome.extension.getURL("assets/images/icon_record_ongoing.png")}chrome.browserAction.setIcon({path:o,tabId:e})}function a(){t(function(r){var i,a=!0,t=(fbdExtensionApp.noYoutube&&r&&r.url&&s.isYoutubeUrl(r.url)&&(a=!1),r&&r.url||"");window.validateUri=window.validateUri||new ValidateUri,window.validateUri.isAdult(t).then(t=>{if(i=!t,r)if(fbdExtensionApp.Media.Storage.hasDataForTab(r.id)&&a&&i){var e=fbdExtensionApp.Media.Storage.getMedia(r.id),o=0;0<(e=s.filter_Media(e)).length&&(o=1);for(var n=0;n<e.length;n++)"start"==e[n].status&&(o=2,"record"==e[n].metod)&&(o=3);c(o,r.id)}else c(0,r.id);else c(0)})})}this.isGtaSuggestion=!1,this.isSmartPause=!1,this.refreshMainButtonStatus=function(){a()},this.filter_Media=function(t){var e,o;return t?(e=[],"video_100kb"==(o=fbdExtensionApp.Prefs.get("fbd.trigger_video_more"))?0:"video_1mb"==o&&0,t.forEach(function(t){s.checkExtByContentType(t.ext)&&(t.size,e.push(t))}),e):[]},this.parsed_Media=function(t){var e=[];return t.forEach(function(t){0<t.priority&&e.push(t)}),e},this.checkExtByContentType=function(t){return"false"!=fbdExtensionApp.Prefs.get("fbd.enable_"+t)},this.isYoutubeUrl=function(t){for(var t=t.toLowerCase(),e=0;e!=o.length;e++)if(-1!=t.indexOf(o[e]))return!0;return!1},this.isTwitchUrl=function(t){for(var t=t.toLowerCase(),e=0;e!=n.length;e++)if(-1!=t.indexOf(n[e]))return!0;return!1},this.isStreamUrl=function(t){for(var t=t.toLowerCase(),e=0;e!=r.length;e++)if(-1!=t.indexOf(r[e]))return!0;return!1},this.getButtonStatus=function(){return i},chrome.tabs.onUpdated.addListener(function(e,o){t(function(t){o.status&&t&&t.id&&t.id==e&&a()})}),chrome.tabs.onActivated.addListener(function(t){a()}),fbdExtensionApp.Media.onMediaForTabUpdate.addListener(function(e){t(function(t){t&&e==t.id&&a()})})}}.apply(fbdExtensionApp):fbdExtensionApp.MainButton=chrome.extension.getBackgroundPage().fbdExtensionApp.MainButton,window==chrome.extension.getBackgroundPage()?function(){this.Download=new function(){var r,t=this,i={};function a(t,e,o,n){var r;t in i&&(r=i[t],r=fbdSingleDownload.Media.Storage.getDataForId(r))&&("start"==e?fbdSingleDownload.Media.Storage.setData_Attribute(r.tabId,r.id,"downloadId",t):"stop"==e?fbdSingleDownload.Media.Storage.setData_Attribute(r.tabId,r.id,"status","stop"):"progress"==e&&fbdSingleDownload.Media.Storage.setData_Attribute(r.tabId,r.id,"progress",{progres:n,progressByte:o}),chrome.extension.sendMessage({subject:"mediaDownloadState",id:r.id,status:e,size:o,progress:n}))}this.start=function(e,t,o,n){console.log("Download.start",e,t,o);try{chrome.downloads.download({url:t,filename:o},function(t){console.log("DOWNLOAD: ",t),i[t]=e,a(t,"start"),n(!1,t)})}catch(t){r=t.name+" "+t.message,n(!0)}},this.stop=function(e,o){console.log("Download.stop",e);try{chrome.downloads.cancel(e,function(){a(e,"stop"),o(!1)})}catch(t){r=t.name+" "+t.message,a(e,"stop"),o(!0)}},this.getError=function(){return""!==r?r:"No Error!"},this.state=function(o){try{chrome.downloads.search({},function(t){var e=[];t.forEach(function(t){"in_progress"==t.state&&t.totalBytes&&(e.push(t),e[e.length-1].mediaId=i[t.id])}),o(e)})}catch(t){r=t.name+" "+t.message,o(!0)}},chrome.downloads.onChanged.addListener(function(t){var e=t.id;!t.state||"complete"!=t.state.current&&"interrupted"!=t.state.current||(a(e,"stop"),delete i[e])}),setInterval(function(){0<Object.keys(i).length&&t.state(function(t){for(var e=0;e<t.length;e++)a(t[e].id,"progress",t[e].bytesReceived,Math.round(100*t[e].bytesReceived/t[e].totalBytes))})},1500)}}.apply(fbdExtensionApp):fbdSingleDownload.Download=chrome.extension.getBackgroundPage().fbdSingleDownload.Download,window==chrome.extension.getBackgroundPage()?function(){this.Record=new function(){var n,r,i={},a=0,s=0;this.start=function(e,t,o){console.log("Record.start",e,t);try{if("undefined"==typeof Worker)throw{name:"Worker",message:"Workers isn't supported!"};n=void 0,(n=new Worker(chrome.runtime.getURL("/worker/worker.js"))).onmessage=function(t){switch(t.data.msg){case"stop":case"runing":i[e]=t.data.videoData,s=void 0===t.data.countTSFiles||void 0===t.data.sizeOfVideo?a=0:(a=t.data.countTSFiles,t.data.sizeOfVideo),o(!1,a,s);break;case"error":r=t.data.error,o(!0,a,s)}},o(!1,0,0,"start"),n.postMessage({cmd:"startRecord",url:t})}catch(t){r=t.name+" "+t.message,o(!0,a,s)}},this.stop=function(t,e){console.log("Record.stop",t);try{n.terminate(),e(!1,function(t,e,o){e=e||"",o=o||512;for(var n=[],r=0;r<t.length;r+=o){for(var i=t.slice(r,r+o),a=new Array(i.length),s=0;s<i.length;s++)a[s]=i.charCodeAt(s);var c=new Uint8Array(a);n.push(c)}return new Blob(n,{type:e})}(i[t],"video/mp2t"),"stop"),delete i[t]}catch(t){r=t.name+" "+t.message,e(!0,null,"stop")}},this.getError=function(){return""!==r?r:"No Error!"}}}.apply(fbdExtensionApp):fbdExtensionApp.Record=chrome.extension.getBackgroundPage().fbdExtensionApp.Record,window==chrome.extension.getBackgroundPage()?function(){function o(p){const u=!1,n=3e5;var l,w=!1,d=!1,m=!1,f=!0,b=null,g=null,v="video",y=0,x=0,S=0,k=0,_=null,r=0,D=[],e=0,i=null,I=null;function T(){u&&console.log("addPlaylist",I.length);for(var t=0;t<I.length;t++)-1==function(t){for(var e=0;e<D.length;e++)if(D[e].url==t)return e;return-1}(I[t])&&D.push({index:D.length,url:I[t],state:0,stream:null});I=null,e=0,u&&console.log("File: ",D.length,D),R()}function R(){if(u&&console.log("load",r,e),r<3&&0==e){x=D.length,e=1;for(var t=0;t<D.length;t++)if(w&&0==D[t].state&&(function(t,e){u&&console.log("loadStreamFile: "+e,t);try{var o=new XMLHttpRequest;(D[e].req=o).open("GET",t,!0),o.ind=e,o.responseType="arraybuffer",o.onreadystatechange=function(){var t,e;4==o.readyState&&(0==(e=o).status||200<=e.status&&e.status<300||304==e.status||1223==e.status?(e=o.ind,D[e].req=null,clearTimeout(D[e].timer),D[e].timer=null,D[e].state=2,t=new Uint8Array(o.response),D[e].stream=i?function(t){if(!t)return"";var e="",o=0,n=0,r=t.byteLength;for(;n<r;){if(!function(t){o=fbdExtensionApp.jspack.ReadInt32(t,n),e=fbdExtensionApp.jspack.bytesToString(t.slice(n+4,n+8)),1==o?(o=fbdExtensionApp.jspack.ReadInt64(t,n+8)-16,n+=16):(o-=8,n+=8);o<=0&&(o=0)}(t),"mdat"==e){r=n+o;break}n+=o}return t.slice(n,r)}(t):t,e=o.getResponseHeader("Content-Length"),S+=parseInt(e),E(!1)):(console.log("===============ERROR===================== httpRequest =========="),E(!0)),r--)},D[e].timer=setTimeout(function(){o.onreadystatechange=null,o.abort(),D[e].req=null,clearTimeout(D[e].timer),D[e].timer=null,D[e].state=3,E(!0),r--},n),o.send(),r++}catch(t){console.log("===============CATCH===================== httpRequest ==========",t),E(!0)}}(D[t].url,D[t].index),D[t].state=1,10<=r))return void(e=0)}}function E(t){if(u&&console.log("endLoadStreamFile: ",t,d),!d){var e=-1,o=!1;m=!0;for(var n=y=k;n<D.length;n++)1<D[n].state?y++:m=!1,D[n].stream?o||(e=n):1==D[n].state&&(o=!0);if(b({msg:"progress",hash:p,size:S,count:y,progress:Math.round(100*y/x)}),m||!w)if(I)setTimeout(function(){T()},1e3);else{var r=[];d=!0,_&&f&&(t=C(_,"video/mp4"),u&&console.log(_,t),r.push(t),f=!1);for(var i=0,a=k;a<D.length;a++)D[a].stream&&(r.push(D[a].stream),i++);0<i?O(r,function(){u&&console.log("UNION",r,i,S),b({msg:"finish",hash:p,size:S,filename:v}),g(p,S,v)}):(u&&console.log("UNION",r,i,S),b({msg:"finish",hash:p,count:i,size:S}),g(p,S,v))}else if(-1!=e){var s=e,c=(s>=D.length&&(s=D.length),d=!0,[]);_&&f&&(t=C(_,"video/mp4"),u&&console.log(_,t),c.push(t),f=!1);for(var h=0,l=k;l<=s;l++)D[l].stream&&(c.push(D[l].stream),h++,D[l].stream.length,D[l].stream=null,D[l].state=3);0<h?(k=s+1,O(c,function(){E(d=!1)})):E(d=!1)}else w&&R()}}function O(t,e){var o,n,r,t=new Blob(t,{type:"video/mp4"});o=t,n=e,a(function(t){t.root.getFile(v,{create:!0},function(t){t.createWriter(function(t){t.onwriteend=function(){u&&console.log("write success"),n(r)},t.onerror=function(t){r=t,console.log("ERROR fileSystem:",t)},t.seek(t.length),t.write(o)})})})}function a(t){webkitRequestFileSystem(TEMPORARY,1073741824,t)}function C(t,e,o){e=e||"",o=o||512;for(var n=[],r=0;r<t.length;r+=o){for(var i=t.slice(r,r+o),a=new Array(i.length),s=0;s<i.length;s++)a[s]=i.charCodeAt(s);var c=new Uint8Array(a);n.push(c)}return new Blob(n,{type:e})}this.start=function(h,t,e,o){var n;u&&console.log("--start--",h,t),w=!0,b=e,g=o,r=0,h=t.hash,l=t.playlist,_=t.initSeg,i=t.params&&t.params.bootstrap?t.params.bootstrap:null,v="video_"+h,n=function(){if("object"==typeof l){for(var t=0;t<l.length;t++)D.push({index:t,url:l[t],state:0,stream:null});u&&console.log("File: ",D.length,D),b({msg:"playlist",hash:h,countTSFiles:x}),R()}else{var e=l,o=function(t){for(var e=0;e<t.length;e++)D.push({index:e,url:t[e],state:0,stream:null});u&&console.log("File: ",D.length,D),b({msg:"playlist",hash:h,countTSFiles:x}),R()};u&&console.log("loadPlayListFile: ",p,e);var n=null,r=e,i="",a=(-1!=(c=r.lastIndexOf("/"))&&(r=r.substr(0,c+1)),n=r,-1!=(c=e.indexOf("//"))&&(i=r.substr(0,c-1),a=r.substring(c+2,r.length),-1!=(c=a.indexOf("/")))&&(n=a.substr(0,c),n=i+"://"+n),e),s=function(t){var e;t&&(e=[],t.split("\n").forEach(function(t){"#"!=t.substring(0,1)&&(t=t.trim())&&(0!=(t=t).indexOf("http")&&(t=0==t.indexOf("/")?n+t:r+t),e.push(t))}),o(e))},c=new XMLHttpRequest;c.open("GET",a,!0),c.setRequestHeader("Cache-Control","no-cache"),c.onload=function(){var t=this.responseText;s(t)},c.onerror=function(){s(null)},c.send(null)}},a(function(t){t.root.getFile(v,{create:!0},function(t){t.createWriter(function(t){t.truncate(0),n()})})})},this.stop=function(){u&&console.log("STREAM.stop"),w=!1},this.playlist=function(t){u&&console.log("STREAM.playlist",t.length),I=t}}this.Stream=new function(){var a={};this.start=function(t,r,i){var e=fbdExtensionApp.Media.Storage.getDataForHash(t),t=(console.log("Stream.start",t,e),e.hash);return a[t]=new o(t),r({msg:"start",hash:t,status:"start",size:0,count:0}),a[t].start(t,e,function(t){r(t)},function(e,o,n){r({msg:"finish",hash:e,status:"stop",size:o}),webkitRequestFileSystem(TEMPORARY,2147483648,function(t){t.root.getFile(n,{create:!0},function(t){i(!1,e,t.toURL(),o,function(){console.log("==FINISH=="),t.remove(function(){console.log("File removed.")},function(t){console.log(t)}),delete a[e]})})})}),t},this.stop=function(t,e){console.log("Stream.stop",t),a[t].stop()},this.playlist=function(t,e){console.log("Stream.playlist",t,e.length),a[t]&&a[t].playlist(e)},this.remove=function(t){console.log("Stream.remove",t),a[t]&&delete a[t]},this.getError=function(){}}}.apply(fbdExtensionApp):fbdExtensionApp.Stream=chrome.extension.getBackgroundPage().fbdExtensionApp.Stream;
